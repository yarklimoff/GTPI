// @observablehq/plot v0.3.2 Copyright 2020-2021 Observable, Inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3@7.2.1/dist/d3.min.js")):"function"==typeof define&&define.amd?define(["exports","d3@7.2.1/dist/d3.min.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Plot=t.Plot||{},t.d3)}(this,(function(t,e){"use strict";function n(t,e){if(t instanceof Date||(t=new Date(+t)),isNaN(t))return"function"==typeof e?e(t):e;const n=t.getUTCHours(),i=t.getUTCMinutes(),o=t.getUTCSeconds(),a=t.getUTCMilliseconds();return`${s=t.getUTCFullYear(),s<0?`-${r(-s,6)}`:s>9999?`+${r(s,6)}`:r(s,4)}-${r(t.getUTCMonth()+1,2)}-${r(t.getUTCDate(),2)}${n||i||o||a?`T${r(n,2)}:${r(i,2)}${o||a?`:${r(o,2)}${a?`.${r(a,3)}`:""}`:""}Z`:""}`;var s}function r(t,e){return`${t}`.padStart(e,"0")}const i=/^(?:[-+]\d{2})?\d{4}(?:-\d{2}(?:-\d{2})?)?(?:T\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?(?:Z|[-+]\d{2}:?\d{2})?)?$/;function o(t){return n(t,"Invalid Date")}function a(t){return null!=t&&!Number.isNaN(t)}function s(t,n){return a(n)-a(t)||e.ascending(t,n)}function l(t){return null!=t&&""!=`${t}`}function c(t,...e){for(const n of e)n&&(t=t.filter((t=>a(n[t]))));return t}function u(t){return t>0?t:NaN}function f(t){return t<0?t:NaN}const d=Symbol("position"),h=Symbol("color"),m=Symbol("radius"),p=Symbol("opacity"),g=new Map([["x",d],["y",d],["fx",d],["fy",d],["r",m],["color",h],["opacity",p]]),y="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5;function v(t,{title:e,fill:n,fillOpacity:r,stroke:i,strokeOpacity:o,strokeWidth:a,opacity:s}){k(t,"fill",n&&(t=>n[t])),k(t,"fill-opacity",r&&(t=>r[t])),k(t,"stroke",i&&(t=>i[t])),k(t,"stroke-opacity",o&&(t=>o[t])),k(t,"stroke-width",a&&(t=>a[t])),k(t,"opacity",s&&(t=>s[t])),function(t){return t?e=>e.filter((e=>l(t[e]))).append("title").text((e=>t[e])):()=>{}}(e)(t)}function x(t,{title:e,fill:n,fillOpacity:r,stroke:i,strokeOpacity:o,strokeWidth:a,opacity:s}){k(t,"fill",n&&(([t])=>n[t])),k(t,"fill-opacity",r&&(([t])=>r[t])),k(t,"stroke",i&&(([t])=>i[t])),k(t,"stroke-opacity",o&&(([t])=>o[t])),k(t,"stroke-width",a&&(([t])=>a[t])),k(t,"opacity",s&&(([t])=>s[t])),function(t){return t?e=>e.filter((([e])=>l(t[e]))).append("title").text((([e])=>t[e])):()=>{}}(e)(t)}function w(t,e){k(t,"fill",e.fill),k(t,"fill-opacity",e.fillOpacity),k(t,"stroke",e.stroke),k(t,"stroke-width",e.strokeWidth),k(t,"stroke-opacity",e.strokeOpacity),k(t,"stroke-linejoin",e.strokeLinejoin),k(t,"stroke-linecap",e.strokeLinecap),k(t,"stroke-miterlimit",e.strokeMiterlimit),k(t,"stroke-dasharray",e.strokeDasharray),k(t,"shape-rendering",e.shapeRendering)}function b(t,e){!function(t,e,n){null!=n&&t.style(e,n)}(t,"mix-blend-mode",e.mixBlendMode),k(t,"opacity",e.opacity)}function k(t,e,n){null!=n&&t.attr(e,n)}function $(t,e,n,r,i){e&&e.bandwidth&&(r+=e.bandwidth()/2),n&&n.bandwidth&&(i+=n.bandwidth()/2),(r||i)&&t.attr("transform",`translate(${r},${i})`)}function M(t,e){if((t=ct(t))!==e)return t}function R(t,e){if((t=ut(t))!==e)return t}function B(t,{fill:e,fillOpacity:n,stroke:r,strokeOpacity:i,strokeWidth:o}){return c(t,e,n,r,i,o)}function A(t){return null==t||"none"===t}const L=/^-?([_a-z]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])([_a-z0-9-]|[\240-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])*$/;function O(t){if(void 0===t)return`plot-${Math.random().toString(16).slice(2)}`;if(t=`${t}`,!L.test(t))throw new Error(`invalid class name: ${t}`);return t}function T(t,e){if("string"==typeof e)t.property("style",e);else if(null!=e)for(const n of t)Object.assign(n.style,e)}function C(t,e){return null==t?null===e?void 0:e:null==e?null===t?void 0:t:(n,r)=>(({data:n,facets:r}=t(n,r)),e(wt(n),r))}function z(t){return(e,n)=>{const r=ot(e,t);return{data:e,facets:n.map((t=>t.filter((t=>r[t]))))}}}function E(t,e){return{data:t,facets:e.map((t=>t.slice().reverse()))}}function N(t){return("function"==typeof t&&1!==t.length?S:Y)(t)}function S(t){return(e,n)=>{const r=(n,r)=>t(e[n],e[r]);return{data:e,facets:n.map((t=>t.slice().sort(r)))}}}function Y(t){return(e,n)=>{const r=ot(e,t),i=(t,e)=>s(r[t],r[e]);return{data:e,facets:n.map((t=>t.slice().sort(i)))}}}function P({filter:t,sort:e,reverse:n,transform:r,...i}={},o){return void 0===r&&(null!=t&&(r=z(t)),null==e||kt(e)||(r=C(r,N(e))),n&&(r=C(r,E))),{...i,...kt(e)&&{sort:e},transform:C(r,o)}}function _(t,e,{data:n=V,filter:r,sort:i,reverse:o,...a}={},s={}){a=G(a,s),n=q(n,lt),i=null==i?void 0:F("sort",i,s),r=null==r?void 0:D("filter",r,s);const[l,c]=zt(t),[u,f]=zt(e),{z:d,fill:h,stroke:m,x1:p,x2:g,y1:y,y2:v,...x}=s,[w,b]=zt(d),[k]=gt(h),[$]=gt(m),[M=h,R]=zt(k),[B=m,A]=zt($);return{..."z"in s&&{z:w||d},..."fill"in s&&{fill:M||h},..."stroke"in s&&{stroke:B||m},...P(x,((s,l)=>{const u=ot(s,t),h=ot(s,e),m=ot(s,d),p=ot(s,k),g=ot(s,$),y=X(a,m,p,g),v=[],x=[],w=u&&c([]),M=h&&f([]),B=m&&b([]),L=p&&R([]),O=g&&A([]);let T=0;for(const t of a)t.initialize(s);i&&i.initialize(s),r&&r.initialize(s);for(const t of l){const e=[];for(const e of a)e.scope("facet",t);i&&i.scope("facet",t),r&&r.scope("facet",t);for(const[o,l]of I(t,y))for(const[t,c]of I(l,h))for(const[l,f]of I(c,u))if(!r||r.reduce(f)){e.push(T++),x.push(n.reduce(f,s)),u&&w.push(l),h&&M.push(t),m&&B.push(y===m?o:m[f[0]]),p&&L.push(y===p?o:p[f[0]]),g&&O.push(y===g?o:g[f[0]]);for(const t of a)t.reduce(f);i&&i.reduce(f)}v.push(e)}return W(v,i,o),{data:x,facets:v}})),...!j(a,"x")&&(l?{x:l}:{x1:p,x2:g}),...!j(a,"y")&&(u?{y:u}:{y1:y,y2:v}),...Object.fromEntries(a.map((({name:t,output:e})=>[t,e])))}}function j(t,...e){for(const{name:n}of t)if(e.includes(n))return!0;return!1}function G(t,e){return Object.entries(t).map((([t,n])=>null==n?{name:t,initialize(){},scope(){},reduce(){}}:F(t,n,e)))}function F(t,e,n){const r=D(t,e,n),[i,o]=Tt(r.label);let a;return{name:t,output:i,initialize(t){r.initialize(t),a=o([])},scope(t,e){r.scope(t,e)},reduce(t,e){a.push(r.reduce(t,e))}}}function D(t,e,n){const r=Ot(t,n),i=q(e,r);let o,a;return{label:Ct(i===Q?null:r,i.label),initialize(t){o=void 0===r?t:ot(t,r),"data"===i.scope&&(a=i.reduce(Bt(t),o))},scope(t,e){i.scope===t&&(a=i.reduce(e,o))},reduce:(t,e)=>null==i.scope?i.reduce(t,o,e):i.reduce(t,o,a,e)}}function I(t,n){return n?e.sort(e.group(t,(t=>n[t])),dt):[[,t]]}function q(t,n){if(t&&"function"==typeof t.reduce)return t;if("function"==typeof t)return r=t,{reduce:(t,e,n)=>r(Lt(e,t),n)};var r;switch(`${t}`.toLowerCase()){case"first":return H;case"last":return Z;case"count":return Q;case"distinct":return J;case"sum":return null==n?Q:K;case"proportion":return tt(n,"data");case"proportion-facet":return tt(n,"facet");case"deviation":return U(e.deviation);case"min":return U(e.min);case"min-index":return U(e.minIndex);case"max":return U(e.max);case"max-index":return U(e.maxIndex);case"mean":return U(e.mean);case"median":return U(e.median);case"variance":return U(e.variance);case"mode":return U(e.mode)}throw new Error("invalid reduce")}function X(t,e,n,r){return function(...t){for(const e of t)if(void 0!==e)return e}(t.some((t=>"z"===t.name))?void 0:e,t.some((t=>"fill"===t.name))?void 0:n,t.some((t=>"stroke"===t.name))?void 0:r)}function W(t,e,n){if(e){const n=e.output.transform(),r=(t,e)=>s(n[t],n[e]);t.forEach((t=>t.sort(r)))}n&&t.forEach((t=>t.reverse()))}function U(t){return{reduce:(e,n)=>t(e,(t=>n[t]))}}const V={reduce:(t,e)=>Lt(e,t)},H={reduce:(t,e)=>e[t[0]]},Z={reduce:(t,e)=>e[t[t.length-1]]},Q={label:"Frequency",reduce:t=>t.length},J={label:"Distinct",reduce:(t,n)=>{const r=new e.InternSet;for(const e of t)r.add(n[e]);return r.size}},K=U(e.sum);function tt(t,n){return null==t?{scope:n,label:"Frequency",reduce:(t,e,n=1)=>t.length/n}:{scope:n,reduce:(t,n,r=1)=>e.sum(t,(t=>n[t]))/r}}const et=Object.getPrototypeOf(Uint8Array),nt=Object.prototype.toString;class rt{constructor(t,e=[],n={},r){const{facet:i="auto",sort:o,dx:a,dy:s}=n,l=new Set;this.data=t,this.sort=kt(o)?o:null,this.facet=null==i||!1===i?null:xt(!0===i?"include":i,"facet",["auto","include","exclude"]);const{transform:c}=P(n);this.transform=c,void 0!==r&&(e=function(t,{title:e,fill:n,fillOpacity:r,stroke:i,strokeWidth:o,strokeOpacity:a,strokeLinejoin:s,strokeLinecap:l,strokeMiterlimit:c,strokeDasharray:u,opacity:f,mixBlendMode:d,shapeRendering:h},m,{fill:p="currentColor",stroke:g="none",strokeWidth:y,strokeLinejoin:v,strokeMiterlimit:x}){null===p&&(n=null,r=null),null===g&&(i=null,a=null),A(p)?A(g)||A(n)||(g="none"):A(g)&&!A(i)&&(p="none");const[w,b]=gt(n,p),[k,$]=yt(r),[B,L]=gt(i,g),[O,T]=yt(a),[C,z]=yt(f);"none"!==L&&(void 0===o&&(o=y),void 0===s&&(s=v),void 0===c&&(c=x));const[E,N]=yt(o);return null!==p&&(t.fill=M(b,"currentColor"),t.fillOpacity=R($,1)),null!==g&&(t.stroke=M(L,"none"),t.strokeWidth=R(N,1),t.strokeOpacity=R(T,1),t.strokeLinejoin=M(s,"miter"),t.strokeLinecap=M(l,"butt"),t.strokeMiterlimit=R(c,4),t.strokeDasharray=ct(u)),t.opacity=R(z,1),t.mixBlendMode=M(d,"normal"),t.shapeRendering=M(h,"auto"),[...m,{name:"title",value:e,optional:!0},{name:"fill",value:w,scale:"color",optional:!0},{name:"fillOpacity",value:k,scale:"opacity",optional:!0},{name:"stroke",value:B,scale:"color",optional:!0},{name:"strokeOpacity",value:O,scale:"opacity",optional:!0},{name:"strokeWidth",value:E,optional:!0},{name:"opacity",value:C,scale:"opacity",optional:!0}]}(this,n,e,r)),this.channels=e.filter((t=>{const{name:e,value:n,optional:r}=t;if(null==n){if(r)return!1;throw new Error(`missing channel value: ${e}`)}if(void 0!==e){const t=`${e}`;if("__proto__"===t)throw new Error("illegal channel name");if(l.has(t))throw new Error(`duplicate channel: ${t}`);l.add(t)}return!0})),this.dx=+a||0,this.dy=+s||0}initialize(t,n){let r=wt(this.data),i=void 0===t&&null!=r?Bt(r):t;void 0!==r&&void 0!==this.transform&&(void 0===t&&(i=i.length?[i]:[]),({facets:i,data:r}=this.transform(r,i)),r=wt(r),void 0===t&&i.length&&([i]=i));const o=this.channels.map((t=>{const{name:e}=t;return[null==e?void 0:`${e}`,it(r,t)]}));return null!=this.sort&&function(t,n,r,i){const{reverse:o,reduce:a=!0,limit:s}=i;for(const l in i){if(!g.has(l))continue;const{value:c,reverse:u=o,reduce:f=a,limit:d=s}=Nt(i[l]);if(null==f||!1===f)continue;const h=t.find((([,{scale:t}])=>t===l))||n&&n.find((([,{scale:t}])=>t===l));if(!h)throw new Error(`missing channel for scale: ${l}`);const m=h[1].value,[p=0,y=1/0]=d&&"function"==typeof d[Symbol.iterator]?d:d<0?[d]:[0,d];if(null==c)h[1].domain=()=>{let t=m;return u&&(t=t.slice().reverse()),0===p&&y===1/0||(t=t.slice(p,y)),t};else{let n;if("data"===c)n=r;else{const e=t.find((([t])=>t===c));if(!e)throw new Error(`missing channel: ${c}`);n=e[1].value}const i=q(!0===f?"max":f,n);h[1].domain=()=>{let t=e.rollup(Bt(m),(t=>i.reduce(t,n)),(t=>m[t]));return t=e.sort(t,u?Ft:Gt),0===p&&y===1/0||(t=t.slice(p,y)),t.map(dt)}}}}(o,n,r,this.sort),{index:i,channels:o}}plot({marks:t=[],...e}={}){return un({...e,marks:[...t,this]})}}function it(t,{scale:e,type:n,value:r}){return{scale:e,type:n,value:ot(t,r),label:Ct(r)}}function ot(t,e,n){const r=void 0===n?Array:n;return"string"==typeof e?r.from(t,at(e)):"function"==typeof e?r.from(t,e):"number"==typeof e||e instanceof Date?r.from(t,mt(e)):e&&"function"==typeof e.transform?wt(e.transform(t),n):wt(e,n)}const at=t=>e=>e[t],st=(t,e)=>e,lt={transform:t=>t},ct=t=>null==t?t:`${t}`,ut=t=>null==t?t:+t,ft=t=>null==t?t:!!t,dt=t=>t[0],ht=t=>t[1],mt=t=>()=>t,pt=new Set(["currentColor","none"]);function gt(t,n){return void 0===t&&(t=n),null===t?[void 0,"none"]:"string"==typeof t&&(pt.has(t)||e.color(t))?[void 0,t]:[t,void 0]}function yt(t,e){return void 0===t&&(t=e),null===t||"number"==typeof t?[void 0,t]:[t,void 0]}function vt(t,e,n){if(null!=t)return xt(t,e,n)}function xt(t,e,n){const r=`${t}`.toLowerCase();if(!n.includes(r))throw new Error(`invalid ${e}: ${t}`);return r}function wt(t,e){return null==t?t:void 0===e?t instanceof Array||t instanceof et?t:Array.from(t):t instanceof e?t:e.from(t)}function bt(t){return t&&t.toString===nt}function kt(t){return bt(t)&&"function"!=typeof t.transform}function $t(t,e,n,r=lt){return void 0===e&&void 0===n?(e=0,n=void 0===t?r:t):void 0===e?e=void 0===t?0:t:void 0===n&&(n=void 0===t?0:t),[e,n]}function Mt(t,e){return void 0===t&&void 0===e?[dt,ht]:[t,e]}function Rt({z:t,fill:e,stroke:n}={}){return void 0===t&&([t]=gt(e)),void 0===t&&([t]=gt(n)),t}function Bt(t){return Uint32Array.from(t,st)}function At(t,e){return Bt(t).filter((n=>e(t[n],n,t)))}function Lt(t,e){return Array.from(e,(e=>t[e]))}function Ot(t,e){if(void 0!==e[t])return e[t];switch(t){case"x1":case"x2":t="x";break;case"y1":case"y2":t="y"}return e[t]}function Tt(t){let e;return[{transform:()=>e,label:Ct(t)},t=>e=t]}function Ct(t,e){return"string"==typeof t?t:t&&void 0!==t.label?t.label:e}function zt(t){return null==t?[t]:Tt(t)}function Et(t,e){return{transform(n){const r=t.transform(n),i=e.transform(n);return Pt(r)||Pt(i)?Array.from(r,((t,e)=>new Date((+r[e]+ +i[e])/2))):Float64Array.from(r,((t,e)=>(+r[e]+ +i[e])/2))},label:t.label}}function Nt(t){return void 0===t||kt(t)?t:{value:t}}function St(t){return{transform:e=>ot(e,t,Float64Array),label:Ct(t)}}function Yt(t){for(const e of t){if(null==e)continue;const t=typeof e;return"string"===t||"boolean"===t}}function Pt(t){for(const e of t)if(null!=e)return e instanceof Date}function _t(t){return t instanceof rt?t:new jt(t)}class jt extends rt{constructor(t){if(super(),null!=t){if("function"!=typeof t)throw new TypeError("invalid mark");this.render=t}}render(){}}function Gt([t,n],[r,i]){return e.ascending(n,i)||e.ascending(t,r)}function Ft([t,n],[r,i]){return e.descending(n,i)||e.ascending(t,r)}class Dt{constructor({name:t="x",axis:e,ticks:n,tickSize:r=("fx"===t?0:6),tickPadding:i=(0===r?9:3),tickFormat:o,fontVariant:a,grid:s,label:l,labelAnchor:c,labelOffset:u,line:f,tickRotate:d}={}){this.name=t,this.axis=xt(e,"axis",["top","bottom"]),this.ticks=n,this.tickSize=ut(r),this.tickPadding=ut(i),this.tickFormat=o,this.fontVariant=M(a,"normal"),this.grid=ft(s),this.label=ct(l),this.labelAnchor=vt(c,"labelAnchor",["center","left","right"]),this.labelOffset=ut(u),this.line=ft(f),this.tickRotate=ut(d)}render(t,{[this.name]:n,fy:r},i,{width:o,height:a,marginTop:s,marginRight:l,marginBottom:c,marginLeft:u,facetMarginTop:f,facetMarginBottom:d,labelMarginLeft:h=0,labelMarginRight:m=0}){const{axis:p,fontVariant:g,grid:y,label:v,labelAnchor:x,labelOffset:w,line:b,tickRotate:k}=this,$="x"===this.name?0:"top"===p?s-f:c-d,M="top"===p?-1:1,R=M*$+("top"===p?s:a-c);return e.create("svg:g").attr("transform",`translate(0,${R})`).call(Xt("top"===p?e.axisTop:e.axisBottom,n,this)).call(Ut,k).attr("font-size",null).attr("font-family",null).attr("font-variant",g).call(b?()=>{}:t=>t.select(".domain").remove()).call(y?r?function(t,e,n){const r=e.bandwidth(),i=e.domain();return o=>o.selectAll(".tick").append("path").attr("stroke","currentColor").attr("stroke-opacity",.1).attr("d",(t?Lt(i,t):i).map((t=>`M0,${e(t)+n}v${r}`)).join(""))}(t,r,-R):(B=M*(c+s-a),t=>t.selectAll(".tick line").clone(!0).attr("stroke-opacity",.1).attr("y2",B)):()=>{}).call(v?t=>t.append("text").attr("fill","currentColor").attr("transform",`translate(${"center"===x?(o+u-l)/2:"right"===x?o+m:-h},${w*M})`).attr("dy","top"===p?"1em":"-0.32em").attr("text-anchor","center"===x?"middle":"right"===x?"end":"start").text(v):()=>{}).node();var B}}class It{constructor({name:t="y",axis:e,ticks:n,tickSize:r=("fy"===t?0:6),tickPadding:i=(0===r?9:3),tickFormat:o,fontVariant:a,grid:s,label:l,labelAnchor:c,labelOffset:u,line:f,tickRotate:d}={}){this.name=t,this.axis=xt(e,"axis",["left","right"]),this.ticks=n,this.tickSize=ut(r),this.tickPadding=ut(i),this.tickFormat=o,this.fontVariant=M(a,"normal"),this.grid=ft(s),this.label=ct(l),this.labelAnchor=vt(c,"labelAnchor",["center","top","bottom"]),this.labelOffset=ut(u),this.line=ft(f),this.tickRotate=ut(d)}render(t,{[this.name]:n,fx:r},i,{width:o,height:a,marginTop:s,marginRight:l,marginBottom:c,marginLeft:u,facetMarginLeft:f,facetMarginRight:d}){const{axis:h,fontVariant:m,grid:p,label:g,labelAnchor:y,labelOffset:v,line:x,tickRotate:w}=this,b="y"===this.name?0:"left"===h?u-f:l-d,k="left"===h?-1:1,$=k*b+("right"===h?o-l:u);return e.create("svg:g").attr("transform",`translate(${$},0)`).call(Xt("right"===h?e.axisRight:e.axisLeft,n,this)).call(Ut,w).attr("font-size",null).attr("font-family",null).attr("font-variant",m).call(x?()=>{}:t=>t.select(".domain").remove()).call(p?r?function(t,e,n){const r=e.bandwidth(),i=e.domain();return o=>o.selectAll(".tick").append("path").attr("stroke","currentColor").attr("stroke-opacity",.1).attr("d",(t?Lt(i,t):i).map((t=>`M${e(t)+n},0h${r}`)).join(""))}(t,r,-$):(M=k*(u+l-o),t=>t.selectAll(".tick line").clone(!0).attr("stroke-opacity",.1).attr("x2",M)):()=>{}).call(g?t=>t.append("text").attr("fill","currentColor").attr("transform",`translate(${v*k},${"center"===y?(a+s-c)/2:"bottom"===y?a-c:s})${"center"===y?" rotate(-90)":""}`).attr("dy","center"===y?"right"===h?"-0.32em":"0.75em":"bottom"===y?"1.4em":"-1em").attr("text-anchor","center"===y?"middle":"right"===h?"end":"start").text(g):()=>{}).node();var M}}function qt(t,n){return void 0===t?Pt(n)?o:ct:"function"==typeof t?t:("string"==typeof t?Pt(n)?e.utcFormat:e.format:mt)(t)}function Xt(t,e,{ticks:n,tickSize:r,tickPadding:i,tickFormat:o}){return e.tickFormat||(o=qt(o,e.domain())),t(e).ticks(Array.isArray(n)?null:n,"function"==typeof o?null:o).tickFormat("function"==typeof o?o:null).tickSizeInner(r).tickSizeOuter(0).tickPadding(i).tickValues(Array.isArray(n)?n:null)}const Wt=Math.PI/180;function Ut(t,e){if(e=+e)for(const n of t.selectAll("text")){const t=+n.getAttribute("x"),r=+n.getAttribute("y");if(Math.abs(r)>Math.abs(t)){const t=Math.sign(r);n.setAttribute("transform",`translate(0, ${r+4*t*Math.cos(e*Wt)}) rotate(${e})`),n.setAttribute("text-anchor",Math.abs(e)<10?"middle":e<0^t>0?"start":"end")}else{const r=Math.sign(t);n.setAttribute("transform",`translate(${t+4*r*Math.abs(Math.sin(e*Wt))}, 0) rotate(${e})`),n.setAttribute("text-anchor",Math.abs(e)>60?"middle":r>0?"start":"end")}n.removeAttribute("x"),n.removeAttribute("y"),n.setAttribute("dy","0.32em")}}const Vt=new Map([["accent",e.schemeAccent],["category10",e.schemeCategory10],["dark2",e.schemeDark2],["paired",e.schemePaired],["pastel1",e.schemePastel1],["pastel2",e.schemePastel2],["set1",e.schemeSet1],["set2",e.schemeSet2],["set3",e.schemeSet3],["tableau10",e.schemeTableau10],["brbg",Zt(e.schemeBrBG,e.interpolateBrBG)],["prgn",Zt(e.schemePRGn,e.interpolatePRGn)],["piyg",Zt(e.schemePiYG,e.interpolatePiYG)],["puor",Zt(e.schemePuOr,e.interpolatePuOr)],["rdbu",Zt(e.schemeRdBu,e.interpolateRdBu)],["rdgy",Zt(e.schemeRdGy,e.interpolateRdGy)],["rdylbu",Zt(e.schemeRdYlBu,e.interpolateRdYlBu)],["rdylgn",Zt(e.schemeRdYlGn,e.interpolateRdYlGn)],["spectral",Zt(e.schemeSpectral,e.interpolateSpectral)],["burd",Qt(e.schemeRdBu,e.interpolateRdBu)],["buylrd",Qt(e.schemeRdGy,e.interpolateRdGy)],["blues",Ht(e.schemeBlues,e.interpolateBlues)],["greens",Ht(e.schemeGreens,e.interpolateGreens)],["greys",Ht(e.schemeGreys,e.interpolateGreys)],["oranges",Ht(e.schemeOranges,e.interpolateOranges)],["purples",Ht(e.schemePurples,e.interpolatePurples)],["reds",Ht(e.schemeReds,e.interpolateReds)],["turbo",Jt(e.interpolateTurbo)],["viridis",Jt(e.interpolateViridis)],["magma",Jt(e.interpolateMagma)],["inferno",Jt(e.interpolateInferno)],["plasma",Jt(e.interpolatePlasma)],["cividis",Jt(e.interpolateCividis)],["cubehelix",Jt(e.interpolateCubehelixDefault)],["warm",Jt(e.interpolateWarm)],["cool",Jt(e.interpolateCool)],["bugn",Ht(e.schemeBuGn,e.interpolateBuGn)],["bupu",Ht(e.schemeBuPu,e.interpolateBuPu)],["gnbu",Ht(e.schemeGnBu,e.interpolateGnBu)],["orrd",Ht(e.schemeOrRd,e.interpolateOrRd)],["pubu",Ht(e.schemePuBu,e.interpolatePuBu)],["pubugn",Ht(e.schemePuBuGn,e.interpolatePuBuGn)],["purd",Ht(e.schemePuRd,e.interpolatePuRd)],["rdpu",Ht(e.schemeRdPu,e.interpolateRdPu)],["ylgn",Ht(e.schemeYlGn,e.interpolateYlGn)],["ylgnbu",Ht(e.schemeYlGnBu,e.interpolateYlGnBu)],["ylorbr",Ht(e.schemeYlOrBr,e.interpolateYlOrBr)],["ylorrd",Ht(e.schemeYlOrRd,e.interpolateYlOrRd)],["rainbow",Kt(e.interpolateRainbow)],["sinebow",Kt(e.interpolateSinebow)]]);function Ht(t,n){return({length:r})=>(r=r>3?Math.floor(r):3)>9?e.quantize(n,r):t[r]}function Zt(t,n){return({length:r})=>2===r?[t[3][0],t[3][2]]:(r=r>3?Math.floor(r):3)>11?e.quantize(n,r):t[r]}function Qt(t,n){return({length:r})=>2===r?[t[3][0],t[3][2]]:(r=r>3?Math.floor(r):3)>11?e.quantize((t=>n(1-t)),r):t[r].slice().reverse()}function Jt(t){return({length:n})=>e.quantize(t,n>0?Math.floor(n):0)}function Kt(t){return({length:n})=>e.quantize(t,n>0?Math.floor(n)+1:1).slice(0,-1)}function te(t){const e=`${t}`.toLowerCase();if(!Vt.has(e))throw new Error(`unknown scheme: ${e}`);return Vt.get(e)}function ee(t,e){const n=te(t),r="function"==typeof n?n({length:e}):n;return r.length!==e?r.slice(0,e):r}const ne=new Map([["brbg",e.interpolateBrBG],["prgn",e.interpolatePRGn],["piyg",e.interpolatePiYG],["puor",e.interpolatePuOr],["rdbu",e.interpolateRdBu],["rdgy",e.interpolateRdGy],["rdylbu",e.interpolateRdYlBu],["rdylgn",e.interpolateRdYlGn],["spectral",e.interpolateSpectral],["burd",t=>e.interpolateRdBu(1-t)],["buylrd",t=>e.interpolateRdYlBu(1-t)],["blues",e.interpolateBlues],["greens",e.interpolateGreens],["greys",e.interpolateGreys],["purples",e.interpolatePurples],["reds",e.interpolateReds],["oranges",e.interpolateOranges],["turbo",e.interpolateTurbo],["viridis",e.interpolateViridis],["magma",e.interpolateMagma],["inferno",e.interpolateInferno],["plasma",e.interpolatePlasma],["cividis",e.interpolateCividis],["cubehelix",e.interpolateCubehelixDefault],["warm",e.interpolateWarm],["cool",e.interpolateCool],["bugn",e.interpolateBuGn],["bupu",e.interpolateBuPu],["gnbu",e.interpolateGnBu],["orrd",e.interpolateOrRd],["pubugn",e.interpolatePuBuGn],["pubu",e.interpolatePuBu],["purd",e.interpolatePuRd],["rdpu",e.interpolateRdPu],["ylgnbu",e.interpolateYlGnBu],["ylgn",e.interpolateYlGn],["ylorbr",e.interpolateYlOrBr],["ylorrd",e.interpolateYlOrRd],["rainbow",e.interpolateRainbow],["sinebow",e.interpolateSinebow]]);function re(t){const e=`${t}`.toLowerCase();if(!ne.has(e))throw new Error(`unknown scheme: ${e}`);return ne.get(e)}const ie=t=>e=>t(1-e),oe=[0,1],ae=new Map([["number",e.interpolateNumber],["rgb",e.interpolateRgb],["hsl",e.interpolateHsl],["hcl",e.interpolateHcl],["lab",e.interpolateLab]]);function se(t){const e=`${t}`.toLowerCase();if(!ae.has(e))throw new Error(`unknown interpolator: ${e}`);return ae.get(e)}function le(t,n,r,{type:i,nice:o,clamp:a,zero:s,domain:l=(g.get(t)===m||g.get(t)===p?de:fe)(r),unknown:c,round:u,scheme:f,range:d=(g.get(t)===m?he(r,l):g.get(t)===p?oe:void 0),interpolate:y=(g.get(t)===h?null==f&&void 0!==d?e.interpolateRgb:re(void 0!==f?f:"cyclical"===i?"rainbow":"turbo"):u?e.interpolateRound:e.interpolateNumber),reverse:v}){if("cyclical"!==i&&"sequential"!==i||(i="linear"),v=!!v,"function"!=typeof y&&(y=se(y)),1===y.length?(v&&(y=ie(y),v=!1),void 0===d&&2===(d=Float64Array.from(l,((t,e)=>e/(l.length-1)))).length&&(d=oe),n.interpolate((d===oe?mt:ge)(y))):n.interpolate(y),s){const[t,n]=e.extent(l);(t>0||n<0)&&(Ye(l=Array.from(l))<0?l[l.length-1]=0:l[0]=0)}return v&&(l=e.reverse(l)),n.domain(l).unknown(c),o&&(n.nice(!0===o?void 0:o),l=n.domain()),void 0!==d&&n.range(d),a&&n.clamp(a),{type:i,domain:l,range:d,scale:n,interpolate:y}}function ce(t,n,{exponent:r=1,...i}){return le(t,e.scalePow().exponent(r),n,{...i,type:"pow"})}function ue(t,n,{domain:r=[0],unknown:i,scheme:o="rdylbu",interpolate:a,range:s=(void 0!==a?e.quantize(a,r.length+1):g.get(t)===h?ee(o,r.length+1):void 0),reverse:l}){if(!e.pairs(r).every((([t,n])=>e.ascending(t,n)<=0)))throw new Error("non-ascending domain");return l&&(s=e.reverse(s)),{type:"threshold",scale:e.scaleThreshold(r,void 0===s?[]:s).unknown(i),domain:r,range:s}}function fe(t,n){return t.length?[e.min(t,(({value:t})=>void 0===t?t:e.min(t,n))),e.max(t,(({value:t})=>void 0===t?t:e.max(t,n)))]:[0,1]}function de(t){return[0,t.length?e.max(t,(({value:t})=>void 0===t?t:e.max(t))):1]}function he(t,n){const r=e.quantile(t,.5,(({value:t})=>void 0===t?NaN:e.quantile(t,.25,u))),i=n.map((t=>3*Math.sqrt(t/r))),o=30/e.max(i);return o<1?i.map((t=>t*o)):i}function me(t){for(const{value:e}of t)if(void 0!==e)for(let n of e){if(n=+n,n>0)return fe(t,u);if(n<0)return fe(t,f)}return[1,10]}function pe(t){const e=[];for(const{value:n}of t)if(void 0!==n)for(const t of n)e.push(t);return e}function ge(t){return(e,n)=>r=>t(e+r*(n-e))}function ye(t,n,r,i,{type:o,nice:a,clamp:s,domain:l=fe(i),unknown:c,pivot:u=0,scheme:f,range:d,symmetric:m=!0,interpolate:p=(g.get(t)===h?null==f&&void 0!==d?e.interpolateRgb:re(void 0!==f?f:"rdbu"):e.interpolateNumber),reverse:y}){u=+u;let[v,x]=l;if(v=Math.min(v,u),x=Math.max(x,u),"function"!=typeof p&&(p=se(p)),void 0!==d&&(p=1===p.length?ge(p)(...d):e.piecewise(p,d)),y&&(p=ie(p)),m){const t=r.apply(u),e=t-r.apply(v),n=r.apply(x)-t;e<n?v=r.invert(t-n):e>n&&(x=r.invert(t+e))}return n.domain([v,u,x]).unknown(c).interpolator(p),s&&n.clamp(s),a&&n.nice(a),{type:o,domain:[v,x],pivot:u,interpolate:p,scale:n}}function ve(t,n,{exponent:r=1,...i}){return ye(t,e.scaleDivergingPow().exponent(r=+r),function(t){return.5===t?ke:{apply:e=>Math.sign(e)*Math.pow(Math.abs(e),t),invert:e=>Math.sign(e)*Math.pow(Math.abs(e),1/t)}}(r),n,{...i,type:"diverging-pow"})}function xe(t,n,{constant:r=1,...i}){return ye(t,e.scaleDivergingSymlog().constant(r=+r),function(t){return{apply:e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),invert:e=>Math.sign(e)*Math.expm1(Math.abs(e))*t}}(r),n,i)}const we={apply:t=>t,invert:t=>t},be={apply:Math.log,invert:Math.exp},ke={apply:t=>Math.sign(t)*Math.sqrt(Math.abs(t)),invert:t=>Math.sign(t)*(t*t)};function $e(t,e,n,r){return le(t,e,n,r)}function Me(t,n,{type:r,domain:i=Be(n),range:o,reverse:a}){return"categorical"===r&&(r="ordinal"),a&&(i=e.reverse(i)),t.domain(i),void 0!==o&&("function"==typeof o&&(o=o(i)),t.range(o)),{type:r,domain:i,range:o,scale:t}}function Re(t,e,n){let{round:r}=n;return void 0!==r&&t.round(r=!!r),(t=Me(t,e,n)).round=r,t}function Be(t){const n=new e.InternSet;for(const{value:e,domain:r}of t){if(void 0!==r)return r();if(void 0!==e)for(const t of e)n.add(t)}return e.sort(n,s)}function Ae(t,e){if(void 0===t.range){const{insetLeft:n,insetRight:r}=t,{width:i,marginLeft:o=0,marginRight:a=0}=e;t.range=[o+n,i-a-r],Ne(t)||(t.range=Te(t)),t.scale.range(t.range)}Oe(t)}function Le(t,e){if(void 0===t.range){const{insetTop:n,insetBottom:r}=t,{height:i,marginTop:o=0,marginBottom:a=0}=e;t.range=[i-a-r,o+n],Ne(t)?t.range.reverse():t.range=Te(t),t.scale.range(t.range)}Oe(t)}function Oe(t){void 0===t.round&&function({type:t}){return"point"===t||"band"===t}(t)&&function({scale:t}){const e=t.domain().length,[n,r]=t.range(),i=t.paddingInner?t.paddingInner():1,o=t.paddingOuter?t.paddingOuter():t.padding(),a=e-i,s=Math.abs(r-n)/Math.max(1,a+2*o);return(s-Math.floor(s))*a}(t)<=30&&t.scale.round(!0)}function Te(t){const e=t.scale.domain().length+function({type:t}){return"threshold"===t}(t);if(!(e>2))return t.range;const[n,r]=t.range;return Array.from({length:e},((t,i)=>n+i/(e-1)*(r-n)))}function Ce(t,e){return ze(t,void 0,{...e})}function ze(t,n=[],r={}){const i=function(t,e,{type:n,domain:r,range:i}){if("fx"===t||"fy"===t)return"band";if(void 0!==n){for(const{type:t}of e)if(void 0!==t&&n!==t)throw new Error(`scale incompatible with channel: ${n} !== ${t}`);return n}if(g.get(t)===m)return"sqrt";if(g.get(t)===p)return"linear";for(const{type:t}of e)if(void 0!==t)return t;if((r||i||[]).length>2)return Ee(t);if(void 0!==r)return Yt(r)?Ee(t):Pt(r)?"utc":"linear";const o=e.map((({value:t})=>t)).filter((t=>void 0!==t));return o.some(Yt)?Ee(t):o.some(Pt)?"utc":"linear"}(t,n,r);switch(r.type=i,i){case"diverging":case"diverging-sqrt":case"diverging-pow":case"diverging-log":case"diverging-symlog":case"cyclical":case"sequential":case"linear":case"sqrt":case"threshold":case"quantile":case"pow":case"log":case"symlog":r=je(n,r,Fe,Float64Array);break;case"identity":g.get(t)===d&&(r=je(n,r,Fe,Float64Array));break;case"utc":case"time":r=je(n,r,De)}switch(i){case"diverging":return function(t,n,r){return ye(t,e.scaleDiverging(),we,n,r)}(t,n,r);case"diverging-sqrt":return function(t,e,n){return ve(t,e,{...n,exponent:.5})}(t,n,r);case"diverging-pow":return ve(t,n,r);case"diverging-log":return function(t,n,{base:r=10,pivot:i=1,domain:o=fe(n,i<0?f:u),...a}){return ye(t,e.scaleDivergingLog().base(r=+r),be,n,{domain:o,pivot:i,...a})}(t,n,r);case"diverging-symlog":return xe(t,n,r);case"categorical":case"ordinal":return function(t,n,{type:r,range:i,scheme:o=(void 0===i?"ordinal"===r?"turbo":"tableau10":void 0),unknown:a,...s}){if(g.get(t)===h&&void 0!==o)if(void 0!==i){const t=re(o),n=i[0],r=i[1]-i[0];i=({length:i})=>e.quantize((e=>t(n+r*e)),i)}else i=te(o);if(a===e.scaleImplicit)throw new Error("implicit unknown is not supported");return Me(e.scaleOrdinal().unknown(a),n,{type:r,range:i,...s})}(t,n,r);case"cyclical":case"sequential":case"linear":return function(t,n,r){return le(t,e.scaleLinear(),n,r)}(t,n,r);case"sqrt":return function(t,e,n){return ce(t,e,{...n,exponent:.5})}(t,n,r);case"threshold":return ue(t,0,r);case"quantile":return function(t,n,{quantiles:r=5,scheme:i="rdylbu",domain:o=pe(n),interpolate:a,range:s=(void 0!==a?e.quantize(a,r):g.get(t)===h?ee(i,r):void 0),reverse:l}){return ue(t,0,{domain:e.scaleQuantile(o,void 0===s?{length:r}:s).quantiles(),range:s,reverse:l})}(t,n,r);case"pow":return ce(t,n,r);case"log":return function(t,n,{base:r=10,domain:i=me(n),...o}){return le(t,e.scaleLog().base(r),n,{...o,domain:i})}(t,n,r);case"symlog":return function(t,n,{constant:r=1,...i}){return le(t,e.scaleSymlog().constant(r),n,i)}(t,n,r);case"utc":return function(t,n,r){return $e(t,e.scaleUtc(),n,r)}(t,n,r);case"time":return function(t,n,r){return $e(t,e.scaleTime(),n,r)}(t,n,r);case"point":return function(t,n,{align:r=.5,padding:i=.5,...o}){return Re(e.scalePoint().align(r).padding(i),n,o)}(0,n,r);case"band":return function(t,n,{align:r=.5,padding:i=.1,paddingInner:o=i,paddingOuter:a=("fx"===t||"fy"===t?0:i),...s}){return Re(e.scaleBand().align(r).paddingInner(o).paddingOuter(a),n,s)}(t,n,r);case"identity":return g.get(t)===d?{type:"identity",scale:e.scaleIdentity()}:{type:"identity"};case void 0:return;default:throw new Error(`unknown scale type: ${i}`)}}function Ee(t){switch(g.get(t)){case d:return"point";case h:return"categorical";default:return"ordinal"}}function Ne({type:t}){return"ordinal"===t||"point"===t||"band"===t}function Se({range:t,domain:e=t}){return Math.sign(Ye(e))*Math.sign(Ye(t))}function Ye(t){if(null==t)return;const n=t[0],r=t[t.length-1];return e.descending(n,r)}function Pe(t=[],e){const n=Object.create(null);for(let[r,{value:i,scale:o}]of t)void 0!==r&&(void 0!==o&&(o=e[o],void 0!==o&&(i=Array.from(i,o))),n[r]=i);return n}function _e(t){const e=t.domain(),n=t(e[0]);for(let r=1,i=e.length;r<i;++r)if(t(e[r])-n)return!1;return!0}function je(t,e,n,r){for(const e of t)e.value=Ge(e.value,n,r);return{...e,domain:Ge(e.domain,n,r)}}function Ge(t,e,n=Array){if(void 0!==t)return n.from(t,e)}function Fe(t){return null==t?NaN:+t}function De(t){return t instanceof Date&&!isNaN(t)?t:"string"==typeof t?function(t,e){return i.test(t+="")?new Date(t):"function"==typeof e?e(t):e}(t):null==t||isNaN(t=+t)?void 0:new Date(t)}function Ie(t){return e=>{if(!g.has(e=`${e}`))throw new Error(`unknown scale: ${e}`);return e in t?function({scale:t,type:e,domain:n,range:r,label:i,interpolate:o,transform:a,percent:s,pivot:l}){if("identity"===e)return{type:"identity",apply:t=>t,invert:t=>t};const c=t.unknown?t.unknown():void 0;return{type:e,domain:Array.from(n),...void 0!==r&&{range:Array.from(r)},...void 0!==a&&{transform:a},...s&&{percent:s},...void 0!==i&&{label:i},...void 0!==c&&{unknown:c},...void 0!==o&&{interpolate:o},...t.clamp&&{clamp:t.clamp()},...void 0!==l&&{pivot:l,symmetric:!1},...t.base&&{base:t.base()},...t.exponent&&{exponent:t.exponent()},...t.constant&&{constant:t.constant()},...t.align&&{align:t.align(),round:t.round()},...t.padding&&(t.paddingInner?{paddingInner:t.paddingInner(),paddingOuter:t.paddingOuter()}:{padding:t.padding()}),apply:e=>t(e),...t.invert&&{invert:e=>t.invert(e)}}}(t[e]):void 0}}function qe(t,n,r){if(void 0===n.ticks){const[i,o]=e.extent(t.scale.range());n.ticks=(o-i)/r}}function Xe(t,e,n){void 0===t.labelAnchor&&(t.labelAnchor=Ne(e)?"center":Se(e)<0?"left":"right"),void 0===t.label&&(t.label=Ve(n,e,t,"x")),e.label=t.label}function We(t,e,n,r){void 0===t.labelAnchor&&(t.labelAnchor=Ne(n)?"center":e&&"top"===e.axis?"bottom":"top"),void 0===t.label&&(t.label=Ve(r,n,t,"y")),n.label=t.label}function Ue(t,e,n,r){r&&(e.label=r.label),void 0===e.label&&(e.label=Ve(n,e,null,t))}function Ve(t=[],e,n,r){let i;for(const{label:e}of t)if(void 0!==e)if(void 0===i)i=e;else if(i!==e)return;if(void 0!==i){if(function({type:t}){return"time"===t||"utc"===t}(e)&&/^(date|time|year)$/i.test(i))return;if(!Ne(e)&&(e.percent&&(i=`${i} (%)`),"x"===r||"y"===r)){const t=Se(e);t&&(i="x"===r||n&&"center"===n.labelAnchor?"x"===r==t<0?`← ${i}`:`${i} →`:`${t<0?"↑ ":"↓ "}${i}`)}}return i}function He(t){return Ne(t)?void 0:"tabular-nums"}function Ze(t,{x:e,y:n,...r},i){return void 0===e&&void 0===n?i:[new Qe(t,{x:e,y:n,...r},i)]}class Qe extends rt{constructor(t,{x:e,y:n,...r}={},i=[]){if(null==t)throw new Error("missing facet data");super(t,[{name:"fx",value:e,scale:"fx",optional:!0},{name:"fy",value:n,scale:"fy",optional:!0}],r),this.marks=i.flat(1/0).map(_t),this.marksChannels=void 0,this.marksIndexByFacet=void 0}initialize(){const{index:t,channels:n}=super.initialize(),r=void 0===t?[]:function(t,e){return(e.length>1?tn:Ke)(t,...e)}(t,n),i=Array.from(r,dt),o=Array.from(r,ht),a=[],s=this.marksChannels=[],l=this.marksIndexByFacet=function(t){return new(t.length>1?nn:en)}(n);for(const t of i)l.set(t,new Array(this.marks.length));let c;for(let r=0;r<this.marks.length;++r){const u=this.marks[r],{facet:f}=u,d="auto"===f?u.data===this.data?o:void 0:"include"===f?o:"exclude"===f?c||(c=o.map((n=>Uint32Array.from(e.difference(t,n))))):void 0,{index:h,channels:m}=u.initialize(d,n);if(void 0!==h)if(d)for(let t=0;t<i.length;++t)l.get(i[t])[r]=h[t];else for(let t=0;t<i.length;++t)l.get(i[t])[r]=h;for(const[,t]of m)a.push([,t]);s.push(m)}return{index:t,channels:[...n,...a]}}render(t,n,r,i,o){const{marks:a,marksChannels:s,marksIndexByFacet:l}=this,{fx:c,fy:u}=n,f=u&&u.domain(),d=c&&c.domain(),h=u&&{marginTop:0,marginBottom:0,height:u.bandwidth()},m=c&&{marginRight:0,marginLeft:0,width:c.bandwidth()},p={...i,...m,...h},g=s.map((t=>Pe(t,n)));return e.create("svg:g").call((t=>{if(u&&o.y){const e=o.y,r=Je(e),a="bottom"===e.labelAnchor?f.length-1:"center"===e.labelAnchor?f.length>>1:0,s={...i,...h};t.selectAll().data(f).join("g").attr("transform",(t=>`translate(0,${u(t)})`)).append(((t,i)=>(i===a?e:r).render(c&&At(d,(e=>l.has([e,t]))),n,null,s)))}if(c&&o.x){const e=o.x,r=Je(e),a="right"===e.labelAnchor?d.length-1:"center"===e.labelAnchor?d.length>>1:0,{marginLeft:s,marginRight:h}=i,p={...i,...m,labelMarginLeft:s,labelMarginRight:h};t.selectAll().data(d).join("g").attr("transform",(t=>`translate(${c(t)},0)`)).append(((t,i)=>(i===a?e:r).render(u&&At(f,(e=>l.has([t,e]))),n,null,p)))}})).call((t=>t.selectAll().data(function({fx:t,fy:n}){return t&&n?e.cross(t.domain(),n.domain()):t?t.domain():n.domain()}(n).filter(l.has,l)).join("g").attr("transform",function(t,e){return t&&e?([n,r])=>`translate(${t(n)},${e(r)})`:t?e=>`translate(${t(e)},0)`:t=>`translate(0,${e(t)})`}(c,u)).each((function(t){const e=l.get(t);for(let t=0;t<a.length;++t){const r=g[t],i=B(e[t],r),o=a[t].render(i,n,r,p);null!=o&&this.appendChild(o)}})))).node()}}function Je(t){return void 0===t||void 0===t.label?t:Object.assign(Object.create(t),{label:void 0})}function Ke(t,[,{value:n}]){return e.groups(t,(t=>n[t]))}function tn(t,[,{value:n}],[,{value:r}]){return e.groups(t,(t=>n[t]),(t=>r[t])).flatMap((([t,e])=>e.map((([e,n])=>[[t,e],n]))))}class en{constructor(){this._=new e.InternMap}has(t){return this._.has(t)}get(t){return this._.get(t)}set(t,e){return this._.set(t,e),this}}class nn extends en{has([t,e]){const n=super.get(t);return!!n&&n.has(e)}get([t,e]){const n=super.get(t);return n&&n.get(e)}set([t,n],r){const i=super.get(t);return i?i.set(n,r):super.set(t,new e.InternMap([[n,r]])),this}}function rn(t,{label:n=t.label,tickSize:r=6,width:i=240,height:o=44+r,marginTop:a=18,marginRight:s=0,marginBottom:l=16+r,marginLeft:c=0,style:u,ticks:f=(i-c-s)/64,tickFormat:d,fontVariant:h=He(t),round:m=!0,className:p}){p=O(p);const g=e.create("svg").attr("class",p).attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("width",i).attr("height",o).attr("viewBox",`0 0 ${i} ${o}`).call((t=>t.append("style").text(`\n        .${p} {\n          display: block;\n          background: white;\n          height: auto;\n          height: intrinsic;\n          max-width: 100%;\n          overflow: visible;\n        }\n        .${p} text {\n          white-space: pre;\n        }\n      `))).call(T,u);let y,v=t=>t.selectAll(".tick line").attr("y1",a+l-o);const x=m?(t,e)=>t.rangeRound(e):(t,e)=>t.range(e),{type:w,domain:b,range:k,interpolate:$,scale:R,pivot:B}=t;if($){const t=void 0===k?$:e.piecewise(1===$.length?ge($):$,k);y=x(R.copy(),e.quantize(e.interpolateNumber(c,i-s),Math.min(b.length+(void 0!==B),void 0===k?1/0:k.length))),g.append("image").attr("x",c).attr("y",a).attr("width",i-c-s).attr("height",o-a-l).attr("preserveAspectRatio","none").attr("xlink:href",function(t,n=256){const r=e.create("canvas").attr("width",n).attr("height",1).node(),i=r.getContext("2d");for(let e=0;e<n;++e)i.fillStyle=t(e/(n-1)),i.fillRect(e,0,1,1);return r}(t).toDataURL())}else if("threshold"===w){const t=b,n=void 0===d?t=>t:"string"==typeof d?e.format(d):d;y=x(e.scaleLinear().domain([-1,k.length-1]),[c,i-s]),g.append("g").selectAll("rect").data(k).join("rect").attr("x",((t,e)=>y(e-1))).attr("y",a).attr("width",((t,e)=>y(e)-y(e-1))).attr("height",o-a-l).attr("fill",(t=>t)),f=Array.from(t,((t,e)=>e)),d=e=>n(t[e],e)}else y=x(e.scaleBand().domain(b),[c,i-s]),g.append("g").selectAll("rect").data(b).join("rect").attr("x",y).attr("y",a).attr("width",Math.max(0,y.bandwidth()-1)).attr("height",o-a-l).attr("fill",R),v=()=>{};return g.append("g").attr("transform",`translate(0,${o-l})`).call(e.axisBottom(y).ticks(Array.isArray(f)?null:f,"string"==typeof d?d:void 0).tickFormat("function"==typeof d?d:void 0).tickSize(r).tickValues(Array.isArray(f)?f:null)).attr("font-size",null).attr("font-family",null).attr("font-variant",M(h,"normal")).call(v).call((t=>t.select(".domain").remove())).call(void 0===n?()=>{}:t=>t.append("text").attr("x",c).attr("y",a+l-o-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").text(n)),g.node()}function on(t,{legend:n=!0,...r}){switch(!0===n&&(n="ordinal"===t.type?"swatches":"ramp"),`${n}`.toLowerCase()){case"swatches":return function(t,{columns:n,tickFormat:r,fontVariant:i=He(t),swatchSize:o=15,swatchWidth:a=o,swatchHeight:s=o,marginLeft:l=0,className:c,style:u,width:f}={}){c=O(c),r=qt(r,t.domain);const d=e.create("div").attr("class",c).attr("style",`\n        --swatchWidth: ${+a}px;\n        --swatchHeight: ${+s}px;\n      `);let h;return null!=n?(h=`\n      .${c}-swatch {\n        display: flex;\n        align-items: center;\n        break-inside: avoid;\n        padding-bottom: 1px;\n      }\n      .${c}-swatch::before {\n        flex-shrink: 0;\n      }\n      .${c}-label {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n    `,d.style("columns",n).selectAll().data(t.domain).join("div").attr("class",`${c}-swatch`).style("--color",t.scale).call((t=>t.append("div").attr("class",`${c}-label`).attr("title",r).text(r)))):(h=`\n      .${c} {\n        display: flex;\n        align-items: center;\n        min-height: 33px;\n      }\n      .${c}-swatch {\n        display: inline-flex;\n        align-items: center;\n        margin-right: 1em;\n      }\n    `,d.selectAll().data(t.domain).join("span").attr("class",`${c}-swatch`).style("--color",t.scale).text(r)),d.call((t=>t.insert("style","*").text(`\n        .${c} {\n          font-family: system-ui, sans-serif;\n          font-size: 10px;\n          margin-bottom: 0.5em;${void 0===l?"":`\n          margin-left: ${+l}px;`}${void 0===f?"":`\n          width: ${f}px;`}\n        }\n        .${c}-swatch::before {\n          content: "";\n          width: var(--swatchWidth);\n          height: var(--swatchHeight);\n          margin-right: 0.5em;\n          background: var(--color);\n        }\n        ${h}\n      `))).style("font-variant",M(i,"normal")).call(T,u).node()}(t,r);case"ramp":return rn(t,r);default:throw new Error(`unknown legend type: ${n}`)}}const an=e.rgb(0,0,0);function sn(t){const{r:n,g:r,b:i}=e.rgb(t)||an;return t=>`rgba(${n},${r},${i},${t})`}const ln=new Map([["color",on],["opacity",function({type:t,interpolate:e,...n},{legend:r=!0,color:i=an,...o}){if(!e)throw new Error(`${t} opacity scales are not supported`);if(!0===r&&(r="ramp"),"ramp"!==`${r}`.toLowerCase())throw new Error(`${r} opacity legends are not supported`);return on({type:t,...n,interpolate:sn(i)},{legend:r,...o})}]]);function cn({label:t,ticks:e,tickFormat:n}={},r={}){return{label:t,ticks:e,tickFormat:n,...r}}function un(t={}){const{facet:n,style:r,caption:i}=t,o=O(t.className);if(void 0!==n){const{marks:e}=t,{data:r}=n;t={...t,marks:Ze(r,n,e)}}const a=void 0===t.marks?[]:t.marks.flat(1/0).map(_t),s=new Map,l=new Map,c=new Map;for(const e of a){if(s.has(e))throw new Error("duplicate mark");const{index:n,channels:r}=e.initialize();for(const[,e]of r){const{scale:n}=e;if(void 0!==n){const r=c.get(n),{percent:i,transform:o=(i?t=>100*t:void 0)}=t[n]||{};null!=o&&(e.value=Array.from(e.value,o)),r?r.push(e):c.set(n,[e])}}s.set(e,r),l.set(e,n)}const u=function(t,{inset:e=0,insetTop:n=e,insetRight:r=e,insetBottom:i=e,insetLeft:o=e,round:a,nice:s,align:l,padding:c,...u}={}){const f={};for(const e of g.keys()){const h=t.get(e),m=u[e];if(h||m){const t=ze(e,h,{round:g.get(e)===d?a:void 0,nice:s,align:l,padding:c,...m});if(t){let{percent:a,transform:s,inset:l,insetTop:c=(void 0!==l?l:"y"===e?n:0),insetRight:u=(void 0!==l?l:"x"===e?r:0),insetBottom:d=(void 0!==l?l:"y"===e?i:0),insetLeft:h=(void 0!==l?l:"x"===e?o:0)}=m||{};if(null==s)s=void 0;else if("function"!=typeof s)throw new Error("invalid scale transform");t.percent=!!a,t.transform=s,"x"===e||"fx"===e?(t.insetLeft=+h,t.insetRight=+u):"y"!==e&&"fy"!==e||(t.insetTop=+c,t.insetBottom=+d),f[e]=t}}}return f}(c,t),f=function(t){return Object.fromEntries(Object.entries(t).map((([t,{scale:e}])=>[t,e])))}(u),h=function({x:t,y:e,fx:n,fy:r},{x:i={},y:o={},fx:a={},fy:s={},axis:l=!0,grid:c,line:u,label:f,facet:{axis:d=l,grid:h,label:m=f}={}}={}){let{axis:p=l}=i,{axis:g=l}=o,{axis:y=d}=a,{axis:v=d}=s;return t?!0===p&&(p="bottom"):p=null,e?!0===g&&(g="left"):g=null,n?!0===y&&(y="bottom"===p?"top":"bottom"):y=null,r?!0===v&&(v="left"===g?"right":"left"):v=null,{...p&&{x:new Dt({grid:c,line:u,label:f,fontVariant:He(t),...i,axis:p})},...g&&{y:new It({grid:c,line:u,label:f,fontVariant:He(e),...o,axis:g})},...y&&{fx:new Dt({name:"fx",grid:h,label:m,...a,axis:y})},...v&&{fy:new It({name:"fy",grid:h,label:m,...s,axis:v})}}}(u,t),m=function(t,{x:{axis:e}={},y:{axis:n}={},fx:{axis:r}={},fy:{axis:i}={}},{width:o=640,height:a=fn(t),facet:{margin:s,marginTop:l=(void 0!==s?s:"top"===r?30:0),marginRight:c=(void 0!==s?s:"right"===i?40:0),marginBottom:u=(void 0!==s?s:"bottom"===r?30:0),marginLeft:f=(void 0!==s?s:"left"===i?40:0)}={},margin:d,marginTop:h=(void 0!==d?d:Math.max(("top"===e?30:0)+l,n||i?20:.5-y)),marginRight:m=(void 0!==d?d:Math.max(("right"===n?40:0)+c,e||r?20:.5+y)),marginBottom:p=(void 0!==d?d:Math.max(("bottom"===e?30:0)+u,n||i?20:.5+y)),marginLeft:g=(void 0!==d?d:Math.max(("left"===n?40:0)+f,e||r?20:.5-y))}={}){return{width:o,height:a,marginTop:h,marginRight:m,marginBottom:p,marginLeft:g,facetMarginTop:l,facetMarginRight:c,facetMarginBottom:u,facetMarginLeft:f}}(u,h,t);!function({x:t,y:e,fx:n,fy:r},i){n&&Ae(n,i),r&&Le(r,i),t&&Ae(t,n?{width:n.scale.bandwidth()}:i),e&&Le(e,r?{height:r.scale.bandwidth()}:i)}(u,m),function(t,e,{x:n,y:r,fx:i,fy:o},a,s){if(i&&(Xe(i,e.fx,t.get("fx")),void 0===i.labelOffset)){const{facetMarginTop:t,facetMarginBottom:e}=a;i.labelOffset="top"===i.axis?t:e}if(o&&(We(o,i,e.fy,t.get("fy")),void 0===o.labelOffset)){const{facetMarginLeft:t,facetMarginRight:e}=a;o.labelOffset="left"===o.axis?t:e}if(n&&(Xe(n,e.x,t.get("x")),void 0===n.labelOffset)){const{marginTop:t,marginBottom:e,facetMarginTop:r,facetMarginBottom:i}=a;n.labelOffset="top"===n.axis?t-r:e-i}if(r&&(We(r,n,e.y,t.get("y")),void 0===r.labelOffset)){const{marginRight:t,marginLeft:e,facetMarginLeft:n,facetMarginRight:i}=a;r.labelOffset="left"===r.axis?e-n:t-i}for(const[n,r]of g)r!==d&&e[n]&&Ue(n,e[n],t.get(n),s[n])}(c,u,h,m,t),function({x:t,y:e,fx:n,fy:r},{x:i,y:o,fx:a,fy:s}){a&&qe(n,a,80),s&&qe(r,s,35),i&&qe(t,i,80),o&&qe(e,o,35)}(u,h);const p=void 0!==n&&f.fx?"fx":"x",v=void 0!==n&&f.fy?"fy":"y";h[p]&&a.unshift(h[p]),h[v]&&a.unshift(h[v]);const{width:x,height:w}=m,b=e.create("svg").attr("class",o).attr("fill","currentColor").attr("font-family","system-ui, sans-serif").attr("font-size",10).attr("text-anchor","middle").attr("width",x).attr("height",w).attr("viewBox",`0 0 ${x} ${w}`).call((t=>t.append("style").text(`\n        .${o} {\n          display: block;\n          background: white;\n          height: auto;\n          height: intrinsic;\n          max-width: 100%;\n        }\n        .${o} text {\n          white-space: pre;\n        }\n      `))).call(T,r).node();for(const t of a){const e=Pe(s.get(t),f),n=B(l.get(t),e),r=t.render(n,f,e,m,h);null!=r&&b.appendChild(r)}let k=b;const $=function(t,e){const n=[];for(const[r,i]of ln){const o=e[r];o&&o.legend&&n.push(i(t[r],cn(t[r],o)))}return n}(u,t);if((null!=i||$.length>0)&&(k=document.createElement("figure"),k.style.maxWidth="initial",k.append(...$,b),null!=i)){const t=document.createElement("figcaption");t.append(i),k.append(t)}return k.scale=Ie(u),k.legend=function(t,e={}){return(n,r)=>{if(!ln.has(n))throw new Error(`unknown legend type: ${n}`);if(n in t)return ln.get(n)(t[n],cn(e[n],r))}}(u,t),k}function fn({y:t,fy:e,fx:n}){const r=e?e.scale.domain().length:1,i=t?Ne(t)?t.scale.domain().length:Math.max(7,17/r):1;return!(!t&&!e)*Math.max(1,Math.min(60,i*r))*20+30*!!n+60}const dn=new Map([["basis",e.curveBasis],["basis-closed",e.curveBasisClosed],["basis-open",e.curveBasisOpen],["bundle",e.curveBundle],["bump-x",e.curveBumpX],["bump-y",e.curveBumpY],["cardinal",e.curveCardinal],["cardinal-closed",e.curveCardinalClosed],["cardinal-open",e.curveCardinalOpen],["catmull-rom",e.curveCatmullRom],["catmull-rom-closed",e.curveCatmullRomClosed],["catmull-rom-open",e.curveCatmullRomOpen],["linear",e.curveLinear],["linear-closed",e.curveLinearClosed],["monotone-x",e.curveMonotoneX],["monotone-y",e.curveMonotoneY],["natural",e.curveNatural],["step",e.curveStep],["step-after",e.curveStepAfter],["step-before",e.curveStepBefore]]);function hn(t=e.curveLinear,n){if("function"==typeof t)return t;const r=dn.get(`${t}`.toLowerCase());if(!r)throw new Error(`unknown curve: ${t}`);if(void 0!==n)switch(r){case e.curveBundle:return r.beta(n);case e.curveCardinalClosed:case e.curveCardinalOpen:case e.curveCardinal:return r.tension(n);case e.curveCatmullRomClosed:case e.curveCatmullRomOpen:case e.curveCatmullRom:return r.alpha(n)}return r}function mn(t={}){const{x:e,x1:n,x2:r}=t;return void 0===n&&void 0===r&&void 0===e?{...t,x:lt}:t}function pn(t={}){const{y:e,y1:n,y2:r}=t;return void 0===n&&void 0===r&&void 0===e?{...t,y:lt}:t}function gn(t={},e={}){1===arguments.length&&([t,e]=bn(t));const{y1:n,y:r=n,x:i,...o}=e,[a,s,l,c]=kn(r,i,"x",t,o);return{...a,y1:n,y:s,x1:l,x2:c,x:Et(l,c)}}function yn(t={},e={}){1===arguments.length&&([t,e]=bn(t));const{x1:n,x:r=n,y:i,...o}=e,[a,s,l,c]=kn(r,i,"y",t,o);return{...a,x1:n,x:s,y1:l,y2:c,y:Et(l,c)}}function vn({x:t,x1:e,x2:n,...r}={}){return r=wn(r,"x"),void 0===e&&void 0===n?gn({x:t,...r}):([e,n]=$t(t,e,n),{...r,x1:e,x2:n})}function xn({y:t,y1:e,y2:n,...r}={}){return r=wn(r,"y"),void 0===e&&void 0===n?yn({y:t,...r}):([e,n]=$t(t,e,n),{...r,y1:e,y2:n})}function wn(t,e){let{sort:n}=t;if(!kt(n))return t;for(const t in n){const{value:r,...i}=Nt(n[t]);r===e&&(n={...n,[t]:{value:`${r}2`,...i}})}return{...t,sort:n}}function bn(t){const{offset:e,order:n,reverse:r,...i}=t;return[{offset:e,order:n,reverse:r},i]}function kn(t,n=(()=>1),r,{offset:i,order:o,reverse:a},s){const l=Rt(s),[c,u]=zt(t),[f,d]=Tt(n),[h,m]=Tt(n);return i=function(t){if(null==t)return;switch(`${t}`.toLowerCase()){case"expand":case"normalize":return Mn;case"center":case"silhouette":return Rn;case"wiggle":return Bn}throw new Error(`unknown offset: ${t}`)}(i),o=function(t,e,n){if(void 0===t&&e===Bn)return En;if(null==t)return;if("string"==typeof t){switch(t.toLowerCase()){case"value":case n:return On;case"z":return Tn;case"sum":return Cn;case"appearance":return zn;case"inside-out":return En}return Nn(at(t))}if("function"==typeof t)return Nn(t);if(Array.isArray(t))return r=t,(t,e,n,i)=>Sn(i,r);var r;throw new Error("invalid order")}(o,i,r),[P(s,((r,s)=>{const c=null==t?void 0:u(ot(r,t)),f=ot(r,n,Float64Array),h=ot(r,l),p=o&&o(r,c,f,h),g=r.length,y=d(new Float64Array(g)),v=m(new Float64Array(g)),x=[];for(const t of s){const n=c?Array.from(e.group(t,(t=>c[t])).values()):[t];p&&Yn(n,p);for(const t of n){let e=0,n=0;a&&t.reverse();for(const r of t){const t=f[r];t<0?e=v[r]=(y[r]=e)+t:t>0?n=v[r]=(y[r]=n)+t:v[r]=y[r]=n}}x.push(n)}return i&&i(x,y,v,h),{data:r,facets:s}})),c,f,h]}function $n(t,e){let n=0,r=0;for(const i of t){const t=e[i];t<n&&(n=t),t>r&&(r=t)}return[n,r]}function Mn(t,e,n){for(const r of t)for(const t of r){const[r,i]=$n(t,n);for(const o of t){const t=1/(i-r||1);e[o]=t*(e[o]-r),n[o]=t*(n[o]-r)}}}function Rn(t,e,n){for(const r of t){for(const t of r){const[r,i]=$n(t,n);for(const o of t){const t=(i+r)/2;e[o]-=t,n[o]-=t}}An(r,e,n)}Ln(t,e,n)}function Bn(t,n,r,i){for(const o of t){const t=new e.InternMap;let a=0;for(const s of o){let o=-1;const l=s.map((t=>Math.abs(r[t]-n[t]))),c=s.map((e=>{o=i?i[e]:++o;const a=r[e]-n[e],s=t.has(o)?a-t.get(o):0;return t.set(o,a),s})),u=[0,...e.cumsum(c)];for(const t of s)n[t]+=a,r[t]+=a;const f=e.sum(l);f&&(a-=e.sum(l,((t,e)=>(c[e]/2+u[e])*t))/f)}An(o,n,r)}Ln(t,n,r)}function An(t,n,r){const i=e.min(t,(t=>e.min(t,(t=>n[t]))));for(const e of t)for(const t of e)n[t]-=i,r[t]-=i}function Ln(t,n,r){const i=t.length;if(1===i)return;const o=t.map((t=>t.flat())),a=o.map((t=>(e.min(t,(t=>n[t]))+e.max(t,(t=>r[t])))/2)),s=e.min(a);for(let t=0;t<i;t++){const e=s-a[t];for(const i of o[t])n[i]+=e,r[i]+=e}}function On(t,e,n){return n}function Tn(t,e,n,r){return r}function Cn(t,n,r,i){return Sn(i,e.groupSort(Bt(t),(t=>e.sum(t,(t=>r[t]))),(t=>i[t])))}function zn(t,n,r,i){return Sn(i,e.groupSort(Bt(t),(t=>n[e.greatest(t,(t=>r[t]))]),(t=>i[t])))}function En(t,n,r,i){const o=Bt(t),a=e.groupSort(o,(t=>n[e.greatest(t,(t=>r[t]))]),(t=>i[t])),s=e.rollup(o,(t=>e.sum(t,(t=>r[t]))),(t=>i[t])),l=[],c=[];let u=0;for(const t of a)u<0?(u+=s.get(t),l.push(t)):(u-=s.get(t),c.push(t));return Sn(i,c.reverse().concat(l))}function Nn(t){return e=>ot(e,t)}function Sn(t,n){return n=new e.InternMap(n.map(((t,e)=>[t,e]))),t.map((t=>n.get(t)))}function Yn(t,e){for(const n of t)n.sort(((t,n)=>s(e[t],e[n])))}const Pn={strokeWidth:1,strokeMiterlimit:1};class _n extends rt{constructor(t,e={}){const{x1:n,y1:r,x2:i,y2:o,curve:a,tension:s}=e;super(t,[{name:"x1",value:n,scale:"x"},{name:"y1",value:r,scale:"y"},{name:"x2",value:i,scale:"x",optional:!0},{name:"y2",value:o,scale:"y",optional:!0},{name:"z",value:Rt(e),optional:!0}],e,Pn),this.curve=hn(a,s)}render(t,{x:n,y:r},i){const{x1:o,y1:s,x2:l=o,y2:c=s,z:u}=i,{dx:f,dy:d}=this;return e.create("svg:g").call(w,this).call($,n,r,f,d).call((n=>n.selectAll().data(u?e.group(t,(t=>u[t])).values():[t]).join("path").call(b,this).call(x,i).attr("d",e.area().curve(this.curve).defined((t=>a(o[t])&&a(s[t])&&a(l[t])&&a(c[t]))).x0((t=>o[t])).y0((t=>s[t])).x1((t=>l[t])).y1((t=>c[t]))))).node()}}function jn({inset:t,insetLeft:e,insetRight:n,...r}={}){return[e,n]=Fn(t,e,n),{inset:t,insetLeft:e,insetRight:n,...r}}function Gn({inset:t,insetTop:e,insetBottom:n,...r}={}){return[e,n]=Fn(t,e,n),{inset:t,insetTop:e,insetBottom:n,...r}}function Fn(t,e,n){return void 0===t&&void 0===e&&void 0===n?y?[1,0]:[.5,.5]:[e,n]}function Dn(t,{interval:e}){return(t={...Nt(t)}).interval=function(t){if(null!=t){if("number"==typeof t){const e=t;t={floor:t=>e*Math.floor(t/e),offset:t=>t+e}}if("function"!=typeof t.floor||"function"!=typeof t.offset)throw new Error("invalid interval");return t}}(void 0===t.interval?e:t.interval),t}function In(t,e,n){const{[t]:r,[`${t}1`]:i,[`${t}2`]:o}=n,{value:a,interval:s}=Dn(r,n);if(null==a||null==s)return n;let l;const c=t=>l||(l=ot(t,a).map((t=>s.floor(t)))),u=Ct(r);return e({...n,[t]:void 0,[`${t}1`]:void 0===i?{transform:c,label:u}:i,[`${t}2`]:void 0===o?{transform:()=>c().map((t=>s.offset(t))),label:u}:o})}function qn(t={}){return In("x",jn,t)}function Xn(t={}){return In("y",Gn,t)}const Wn={};class Un extends rt{constructor(t,e,n={}){super(t,e,n,Wn);const{inset:r=0,insetTop:i=r,insetRight:o=r,insetBottom:a=r,insetLeft:s=r,rx:l,ry:c}=n;this.insetTop=ut(i),this.insetRight=ut(o),this.insetBottom=ut(a),this.insetLeft=ut(s),this.rx=M(l,"auto"),this.ry=M(c,"auto")}render(t,n,r,i){const{dx:o,dy:a,rx:s,ry:l}=this,u=c(t,...this._positions(r));return e.create("svg:g").call(w,this).call(this._transform,n,o,a).call((t=>t.selectAll().data(u).join("rect").call(b,this).attr("x",this._x(n,r,i)).attr("width",this._width(n,r,i)).attr("y",this._y(n,r,i)).attr("height",this._height(n,r,i)).call(k,"rx",s).call(k,"ry",l).call(v,r))).node()}_x(t,{x:e},{marginLeft:n}){const{insetLeft:r}=this;return e?t=>e[t]+r:n+r}_y(t,{y:e},{marginTop:n}){const{insetTop:r}=this;return e?t=>e[t]+r:n+r}_width({x:t},{x:e},{marginRight:n,marginLeft:r,width:i}){const{insetLeft:o,insetRight:a}=this,s=e?t.bandwidth():i-n-r;return Math.max(0,s-o-a)}_height({y:t},{y:e},{marginTop:n,marginBottom:r,height:i}){const{insetTop:o,insetBottom:a}=this,s=e?t.bandwidth():i-n-r;return Math.max(0,s-o-a)}}class Vn extends Un{constructor(t,e={}){const{x1:n,x2:r,y:i}=e;super(t,[{name:"x1",value:n,scale:"x"},{name:"x2",value:r,scale:"x"},{name:"y",value:i,scale:"y",type:"band",optional:!0}],e)}_transform(t,{x:e},n,r){t.call($,e,null,n,r)}_positions({x1:t,x2:e,y:n}){return[t,e,n]}_x({x:t},{x1:e,x2:n},{marginLeft:r}){const{insetLeft:i}=this;return _e(t)?r+i:t=>Math.min(e[t],n[t])+i}_width({x:t},{x1:e,x2:n},{marginRight:r,marginLeft:i,width:o}){const{insetLeft:a,insetRight:s}=this;return _e(t)?o-r-i-a-s:t=>Math.max(0,Math.abs(n[t]-e[t])-a-s)}}class Hn extends Un{constructor(t,e={}){const{x:n,y1:r,y2:i}=e;super(t,[{name:"y1",value:r,scale:"y"},{name:"y2",value:i,scale:"y"},{name:"x",value:n,scale:"x",type:"band",optional:!0}],e)}_transform(t,{y:e},n,r){t.call($,null,e,n,r)}_positions({y1:t,y2:e,x:n}){return[t,e,n]}_y({y:t},{y1:e,y2:n},{marginTop:r}){const{insetTop:i}=this;return _e(t)?r+i:t=>Math.min(e[t],n[t])+i}_height({y:t},{y1:e,y2:n},{marginTop:r,marginBottom:i,height:o}){const{insetTop:a,insetBottom:s}=this;return _e(t)?o-r-i-a-s:t=>Math.max(0,Math.abs(n[t]-e[t])-a-s)}}class Zn extends Un{constructor(t,{x:e,y:n,...r}={}){super(t,[{name:"x",value:e,scale:"x",type:"band",optional:!0},{name:"y",value:n,scale:"y",type:"band",optional:!0}],r)}_transform(){}_positions({x:t,y:e}){return[t,e]}}const Qn={fill:"none",stroke:"currentColor",strokeWidth:1.5};class Jn extends rt{constructor(t,e={}){const{x:n,y:r,r:i}=e,[o,a]=yt(i,3);super(t,[{name:"x",value:n,scale:"x",optional:!0},{name:"y",value:r,scale:"y",optional:!0},{name:"r",value:o,scale:"r",optional:!0}],e,Qn),this.r=a}render(t,{x:n,y:r},i,{width:o,height:a,marginTop:s,marginRight:l,marginBottom:f,marginLeft:d}){const{x:h,y:m,r:p}=i,{dx:g,dy:x}=this;let k=c(t,h,m);return p&&(k=k.filter((t=>u(p[t])))),e.create("svg:g").call(w,this).call($,n,r,y+g,y+x).call((t=>t.selectAll().data(k).join("circle").call(b,this).attr("cx",h?t=>h[t]:(d+o-l)/2).attr("cy",m?t=>m[t]:(s+a-f)/2).attr("r",p?t=>p[t]:this.r).call(v,i))).node()}}const Kn={fill:"none",stroke:"currentColor"};class tr extends rt{constructor(t={}){const{inset:e=0,insetTop:n=e,insetRight:r=e,insetBottom:i=e,insetLeft:o=e}=t;super(void 0,void 0,t,Kn),this.insetTop=ut(n),this.insetRight=ut(r),this.insetBottom=ut(i),this.insetLeft=ut(o)}render(t,n,r,i){const{marginTop:o,marginRight:a,marginBottom:s,marginLeft:l,width:c,height:u}=i,{insetTop:f,insetRight:d,insetBottom:h,insetLeft:m,dx:p,dy:g}=this;return e.create("svg:rect").call(w,this).call(b,this).call($,null,null,y+p,y+g).attr("x",l+m).attr("y",o+f).attr("width",c-l-a-m-d).attr("height",u-o-s-f-h).node()}}const er={fill:null,stroke:null};class nr extends rt{constructor(t,e={}){let{x:n,y:r,width:i,height:o,src:a,preserveAspectRatio:s,crossOrigin:l}=e;void 0===i&&void 0!==o?i=o:void 0===o&&void 0!==i&&(o=i);const[c,u]="string"==typeof(f=a)&&(function(t){return/^\.*\//.test(t)}(f)||function(t){return/^(blob|data|file|http|https):/i.test(t)}(f))?[void 0,f]:[f,void 0];var f;const[d,h]=yt(i,16),[m,p]=yt(o,16);super(t,[{name:"x",value:n,scale:"x",optional:!0},{name:"y",value:r,scale:"y",optional:!0},{name:"width",value:d,optional:!0},{name:"height",value:m,optional:!0},{name:"src",value:c,optional:!0}],e,er),this.src=u,this.width=h,this.height=p,this.preserveAspectRatio=M(s,"xMidYMid"),this.crossOrigin=ct(l)}render(t,{x:n,y:r},i,{width:o,height:a,marginTop:s,marginRight:l,marginBottom:f,marginLeft:d}){const{x:h,y:m,width:p,height:g,src:x}=i;let M=c(t,h,m,x);p&&(M=M.filter((t=>u(p[t])))),g&&(M=M.filter((t=>u(g[t]))));const R=(d+o-l)/2,B=(s+a-f)/2;return e.create("svg:g").call(w,this).call($,n,r,y,y).call((t=>t.selectAll().data(M).join("image").call(b,this).attr("x",p&&h?t=>h[t]-p[t]/2:p?t=>R-p[t]/2:h?t=>h[t]-this.width/2:R-this.width/2).attr("y",g&&m?t=>m[t]-g[t]/2:g?t=>B-g[t]/2:m?t=>m[t]-this.height/2:B-this.height/2).attr("width",p?t=>p[t]:this.width).attr("height",g?t=>g[t]:this.height).call(k,"href",x?t=>x[t]:this.src).call(k,"preserveAspectRatio",this.preserveAspectRatio).call(k,"crossorigin",this.crossOrigin).call(v,i))).node()}}const rr={fill:"none",stroke:"currentColor",strokeWidth:1.5,strokeMiterlimit:1};class ir extends rt{constructor(t,e={}){const{x:n,y:r,curve:i,tension:o}=e;super(t,[{name:"x",value:n,scale:"x"},{name:"y",value:r,scale:"y"},{name:"z",value:Rt(e),optional:!0}],e,rr),this.curve=hn(i,o)}render(t,{x:n,y:r},i){const{x:o,y:s,z:l}=i,{dx:c,dy:u}=this;return e.create("svg:g").call(w,this).call($,n,r,y+c,y+u).call((n=>n.selectAll().data(l?e.group(t,(t=>l[t])).values():[t]).join("path").call(b,this).call(x,i).attr("d",e.line().curve(this.curve).defined((t=>a(o[t])&&a(s[t]))).x((t=>o[t])).y((t=>s[t]))))).node()}}const or={fill:"none",stroke:"currentColor",strokeMiterlimit:1};class ar extends rt{constructor(t,e={}){const{x1:n,y1:r,x2:i,y2:o,curve:a}=e;super(t,[{name:"x1",value:n,scale:"x"},{name:"y1",value:r,scale:"y"},{name:"x2",value:i,scale:"x",optional:!0},{name:"y2",value:o,scale:"y",optional:!0}],e,or),this.curve=hn(a)}render(t,{x:n,y:r},i){const{x1:o,y1:a,x2:s=o,y2:l=a}=i,{dx:u,dy:f}=this,d=c(t,o,a,s,l);return e.create("svg:g").call(w,this).call($,n,r,y+u,y+f).call((t=>t.selectAll().data(d).join("path").call(b,this).attr("d",(t=>{const n=e.path(),r=this.curve(n);return r.lineStart(),r.point(o[t],a[t]),r.point(s[t],l[t]),r.lineEnd(),`${n}`})).call(v,i))).node()}}function sr(t,e,n){if(void 0===t){if(void 0===e){if(void 0!==n)return[n]}else if(void 0===n)return[e]}else{if(void 0===e)return void 0===n?[t]:[t,n];if(void 0===n)return[t,e]}return[e,n]}const lr={};class cr extends rt{constructor(t,e={}){const{x1:n,y1:r,x2:i,y2:o,inset:a=0,insetTop:s=a,insetRight:l=a,insetBottom:c=a,insetLeft:u=a,rx:f,ry:d}=e;super(t,[{name:"x1",value:n,scale:"x",optional:!0},{name:"y1",value:r,scale:"y",optional:!0},{name:"x2",value:i,scale:"x",optional:!0},{name:"y2",value:o,scale:"y",optional:!0}],e,lr),this.insetTop=ut(s),this.insetRight=ut(l),this.insetBottom=ut(c),this.insetLeft=ut(u),this.rx=M(f,"auto"),this.ry=M(d,"auto")}render(t,{x:n,y:r},i,o){const{x1:a,y1:s,x2:l,y2:u}=i,{marginTop:f,marginRight:d,marginBottom:h,marginLeft:m,width:p,height:g}=o,{insetTop:y,insetRight:x,insetBottom:M,insetLeft:R,dx:B,dy:A,rx:L,ry:O}=this,T=c(t,a,u,l,u);return e.create("svg:g").call(w,this).call($,n,r,B,A).call((t=>t.selectAll().data(T).join("rect").call(b,this).attr("x",a&&l&&!_e(n)?t=>Math.min(a[t],l[t])+R:m+R).attr("y",s&&u&&!_e(r)?t=>Math.min(s[t],u[t])+y:f+y).attr("width",a&&l&&!_e(n)?t=>Math.max(0,Math.abs(l[t]-a[t])-R-x):p-d-m-x-R).attr("height",s&&u&&!_e(r)?t=>Math.max(0,Math.abs(s[t]-u[t])-y-M):g-f-h-y-M).call(k,"rx",L).call(k,"ry",O).call(v,i))).node()}}const ur={fill:null,stroke:"currentColor"};class fr extends rt{constructor(t,e={}){const{x:n,y1:r,y2:i,inset:o=0,insetTop:a=o,insetBottom:s=o}=e;super(t,[{name:"x",value:n,scale:"x",optional:!0},{name:"y1",value:r,scale:"y",optional:!0},{name:"y2",value:i,scale:"y",optional:!0}],e,ur),this.insetTop=ut(a),this.insetBottom=ut(s)}render(t,{x:n,y:r},i,o){const{x:a,y1:s,y2:l}=i,{width:u,height:f,marginTop:d,marginRight:h,marginLeft:m,marginBottom:p}=o,{insetTop:g,insetBottom:x}=this,k=c(t,a,s,l);return e.create("svg:g").call(w,this).call($,a&&n,null,y,0).call((t=>t.selectAll("line").data(k).join("line").call(b,this).attr("x1",a?t=>a[t]:(m+u-h)/2).attr("x2",a?t=>a[t]:(m+u-h)/2).attr("y1",s&&!_e(r)?t=>s[t]+g:d+g).attr("y2",l&&!_e(r)?r.bandwidth?t=>l[t]+r.bandwidth()-x:t=>l[t]-x:f-p-x).call(v,i))).node()}}class dr extends rt{constructor(t,e={}){const{x1:n,x2:r,y:i,inset:o=0,insetRight:a=o,insetLeft:s=o}=e;super(t,[{name:"y",value:i,scale:"y",optional:!0},{name:"x1",value:n,scale:"x",optional:!0},{name:"x2",value:r,scale:"x",optional:!0}],e,ur),this.insetRight=ut(a),this.insetLeft=ut(s)}render(t,{x:n,y:r},i,o){const{y:a,x1:s,x2:l}=i,{width:u,height:f,marginTop:d,marginRight:h,marginLeft:m,marginBottom:p}=o,{insetLeft:g,insetRight:x,dx:k,dy:M}=this,R=c(t,a,s,l);return e.create("svg:g").call(w,this).call($,null,a&&r,k,y+M).call((t=>t.selectAll("line").data(R).join("line").call(b,this).attr("x1",s&&!_e(n)?t=>s[t]+g:m+g).attr("x2",l&&!_e(n)?n.bandwidth?t=>l[t]+n.bandwidth()-x:t=>l[t]-x:u-h-x).attr("y1",a?t=>a[t]:(d+f-p)/2).attr("y2",a?t=>a[t]:(d+f-p)/2).call(v,i))).node()}}function hr(t,e,n){if(void 0===t){if(void 0===e){if(void 0!==n)return[0,n]}else if(void 0===n)return[0,e]}else{if(void 0===e)return void 0===n?[0,t]:[t,n];if(void 0===n)return[t,e]}return[e,n]}const mr={strokeLinejoin:"round"};class pr extends rt{constructor(t,e={}){const{x:n,y:r,text:i=st,textAnchor:o,fontFamily:a,fontSize:s,fontStyle:l,fontVariant:c,fontWeight:u,dx:f,dy:d="0.32em",rotate:h}=e,[m,p]=yt(h,0),[g,y]=yt(s);super(t,[{name:"x",value:n,scale:"x",optional:!0},{name:"y",value:r,scale:"y",optional:!0},{name:"fontSize",value:St(g),optional:!0},{name:"rotate",value:St(m),optional:!0},{name:"text",value:i}],e,mr),this.rotate=p,this.textAnchor=ct(o),this.fontFamily=ct(a),this.fontSize=y,this.fontStyle=ct(l),this.fontVariant=ct(c),this.fontWeight=ct(u),this.dx=ct(f),this.dy=ct(d)}render(t,{x:n,y:r},i,o){const{x:a,y:s,rotate:u,text:f,fontSize:d}=i,{width:h,height:m,marginTop:p,marginRight:g,marginBottom:x,marginLeft:w}=o,{rotate:b}=this,M=c(t,a,s,u).filter((t=>l(f[t]))),R=(w+h-g)/2,B=(p+m-x)/2;return e.create("svg:g").call(gr,this).call($,n,r,y,y).call((t=>t.selectAll().data(M).join("text").call(yr,this).call(u?t=>t.attr("transform",a&&s?t=>`translate(${a[t]},${s[t]}) rotate(${u[t]})`:a?t=>`translate(${a[t]},${B}) rotate(${u[t]})`:s?t=>`translate(${R},${s[t]}) rotate(${u[t]})`:t=>`translate(${R},${B}) rotate(${u[t]})`):b?t=>t.attr("transform",a&&s?t=>`translate(${a[t]},${s[t]}) rotate(${b})`:a?t=>`translate(${a[t]},${B}) rotate(${b})`:s?t=>`translate(${R},${s[t]}) rotate(${b})`:`translate(${R},${B}) rotate(${b})`):t=>t.attr("x",a?t=>a[t]:R).attr("y",s?t=>s[t]:B)).call(k,"font-size",d&&(t=>d[t])).text((t=>f[t])).call(v,i))).node()}}function gr(t,e){w(t,e),k(t,"text-anchor",e.textAnchor),k(t,"font-family",e.fontFamily),k(t,"font-size",e.fontSize),k(t,"font-style",e.fontStyle),k(t,"font-variant",e.fontVariant),k(t,"font-weight",e.fontWeight)}function yr(t,e){b(t,e),k(t,"dx",e.dx),k(t,"dy",e.dy)}const vr={fill:null,stroke:"currentColor"};class xr extends rt{constructor(t,e,n){super(t,e,n,vr)}render(t,n,r,i){const{x:o,y:a}=r,{dx:s,dy:l}=this,u=c(t,o,a);return e.create("svg:g").call(w,this).call(this._transform,n,s,l).call((t=>t.selectAll("line").data(u).join("line").call(b,this).attr("x1",this._x1(n,r,i)).attr("x2",this._x2(n,r,i)).attr("y1",this._y1(n,r,i)).attr("y2",this._y2(n,r,i)).call(v,r))).node()}}class wr extends xr{constructor(t,e={}){const{x:n,y:r,inset:i=0,insetTop:o=i,insetBottom:a=i}=e;super(t,[{name:"x",value:n,scale:"x"},{name:"y",value:r,scale:"y",type:"band",optional:!0}],e),this.insetTop=ut(o),this.insetBottom=ut(a)}_transform(t,{x:e},n,r){t.call($,e,null,y+n,r)}_x1(t,{x:e}){return t=>e[t]}_x2(t,{x:e}){return t=>e[t]}_y1(t,{y:e},{marginTop:n}){const{insetTop:r}=this;return e?t=>e[t]+r:n+r}_y2({y:t},{y:e},{height:n,marginBottom:r}){const{insetBottom:i}=this;return e?n=>e[n]+t.bandwidth()-i:n-r-i}}class br extends xr{constructor(t,e={}){const{x:n,y:r,inset:i=0,insetRight:o=i,insetLeft:a=i}=e;super(t,[{name:"y",value:r,scale:"y"},{name:"x",value:n,scale:"x",type:"band",optional:!0}],e),this.insetRight=ut(o),this.insetLeft=ut(a)}_transform(t,{y:e},n,r){t.call($,null,e,n,y+r)}_x1(t,{x:e},{marginLeft:n}){const{insetLeft:r}=this;return e?t=>e[t]+r:n+r}_x2({x:t},{x:e},{width:n,marginRight:r}){const{insetRight:i}=this;return e?n=>e[n]+t.bandwidth()-i:n-r-i}_y1(t,{y:e}){return t=>e[t]}_y2(t,{y:e}){return t=>e[t]}}function kr(t,e,n,r,{data:i=V,filter:o=Q,sort:a,reverse:s,...l}={},c={}){t=Rr(t),e=Rr(e),l=G(l,c),i=q(i,lt),a=null==a?void 0:F("sort",a,c),o=null==o?void 0:D("filter",o,c),null!=n&&j(l,"x","x1","x2")&&(n=null),null!=r&&j(l,"y","y1","y2")&&(r=null);const[u,f]=zt(t),[d,h]=zt(t),[m,p]=zt(e),[g,y]=zt(e),[v,x]=null!=n?[n,"x"]:null!=r?[r,"y"]:[],[w,b]=zt(v),{x:k,y:$,z:M,fill:R,stroke:B,x1:A,x2:L,y1:O,y2:T,domain:C,cumulative:z,thresholds:E,...N}=c,[S,Y]=zt(M),[_]=gt(R),[U]=gt(B),[H=R,Z]=zt(_),[J=B,K]=zt(U);return{..."z"in c&&{z:S||M},..."fill"in c&&{fill:H||R},..."stroke"in c&&{stroke:J||B},...P(N,((n,r)=>{const c=ot(n,v),u=ot(n,M),d=ot(n,_),m=ot(n,U),g=X(l,u,d,m),x=[],w=[],k=c&&b([]),$=u&&Y([]),R=d&&Z([]),B=m&&K([]),A=t?t(n):[[,,t=>t]],L=e?e(n):[[,,t=>t]],O=t&&f([]),T=t&&h([]),C=e&&p([]),z=e&&y([]);let E=0;for(const t of l)t.initialize(n);a&&a.initialize(n),o&&o.initialize(n);for(const t of r){const e=[];for(const e of l)e.scope("facet",t);a&&a.scope("facet",t),o&&o.scope("facet",t);for(const[r,s]of I(t,g))for(const[t,f]of I(s,c))for(const[s,h,p]of A){const y=p(f);for(const[f,p,v]of L){const x={x1:s,x2:h,y1:f,y2:p},b=v(y);if(!o||o.reduce(b,x)){e.push(E++),w.push(i.reduce(b,n,x)),c&&k.push(t),u&&$.push(g===u?r:u[b[0]]),d&&R.push(g===d?r:d[b[0]]),m&&B.push(g===m?r:m[b[0]]),O&&(O.push(s),T.push(h)),C&&(C.push(f),z.push(p));for(const t of l)t.reduce(b,x);a&&a.reduce(b)}}}x.push(e)}return W(x,a,s),{data:w,facets:x}})),...!j(l,"x")&&(u?{x1:u,x2:d,x:Et(u,d)}:{x:k,x1:A,x2:L}),...!j(l,"y")&&(m?{y1:m,y2:g,y:Et(m,g)}:{y:$,y1:O,y2:T}),...w&&{[x]:w},...Object.fromEntries(l.map((({name:t,output:e})=>[t,e])))}}function $r({cumulative:t,domain:e,thresholds:n,...r},i){return[r,{cumulative:t,domain:e,thresholds:n,...i}]}function Mr(t,{cumulative:n,domain:r,thresholds:i},o){return void 0===(t={...Nt(t)}).domain&&(t.domain=r),void 0===t.cumulative&&(t.cumulative=n),void 0===t.thresholds&&(t.thresholds=i),void 0===t.value&&(t.value=o),t.thresholds=function(t=Br){if("string"==typeof t){switch(t.toLowerCase()){case"freedman-diaconis":return e.thresholdFreedmanDiaconis;case"scott":return e.thresholdScott;case"sturges":return e.thresholdSturges;case"auto":return Br}throw new Error("invalid thresholds")}return t}(t.thresholds),t}function Rr(t){if(null==t)return;const{value:n,cumulative:r,domain:i=e.extent,thresholds:o}=t,a=t=>{let a=ot(t,n);const s=e.bin().value((t=>a[t]));if(Pt(a)||(function(t){return Ar(t)&&"function"==typeof t&&t()instanceof Date}(l=o)||l&&l[Symbol.iterator]&&Pt(l))){a=a.map(De);let[t,n]="function"==typeof i?i(a):i,r="function"!=typeof o||Ar(o)?o:o(a,t,n);"number"==typeof r&&(r=e.utcTickInterval(t,n,r)),Ar(r)&&(i===e.extent&&(t=r.floor(t),n=r.ceil(new Date(+n+1))),r=r.range(t,n)),s.thresholds(r).domain([t,n])}else s.thresholds(o).domain(i);var l;let c=s(Bt(t)).map(Lr);return r&&(c=(r<0?c.reverse():c).map(Or)),c.map(Tr)};return a.label=Ct(n),a}function Br(t,n,r){return Math.min(200,e.thresholdScott(t,n,r))}function Ar(t){return!!t&&"function"==typeof t.range}function Lr(t){return[t,new Set(t)]}function Or([t],e,n){return[t,{get size(){for(let t=0;t<=e;++t)if(n[t][1].size)return 1;return 0},has(t){for(let r=0;r<=e;++r)if(n[r][1].has(t))return!0;return!1}}]}function Tr([{x0:t,x1:e},n]){return[t,e,n.size?t=>t.filter(n.has,n):Cr]}function Cr(){return new Uint32Array(0)}function zr(t,e={}){return Nr(Object.fromEntries(["x","x1","x2"].filter((t=>null!=e[t])).map((e=>[e,t]))),e)}function Er(t,e={}){return Nr(Object.fromEntries(["y","y1","y2"].filter((t=>null!=e[t])).map((e=>[e,t]))),e)}function Nr(t={},n={}){const r=Rt(n),i=Object.entries(t).map((([t,e])=>{const r=Ot(t,n);if(null==r)throw new Error(`missing channel: ${t}`);const[i,o]=Tt(r);return{key:t,input:r,output:i,setOutput:o,map:Sr(e)}}));return{...P(n,((t,n)=>{const o=ot(t,r),a=i.map((({input:e})=>ot(t,e))),s=i.map((({setOutput:e})=>e(new Array(t.length))));for(const t of n)for(const n of o?e.group(t,(t=>o[t])).values():[t])i.forEach((({map:t},e)=>t.map(n,a[e],s[e])));return{data:t,facets:n}})),...Object.fromEntries(i.map((({key:t,output:e})=>[t,e])))}}function Sr(t){if(t&&"function"==typeof t.map)return t;if("function"==typeof t)return Pr(t);switch(`${t}`.toLowerCase()){case"cumsum":return _r;case"rank":return Pr(e.rank);case"quantile":return Pr(Yr)}throw new Error("invalid map")}function Yr(t){const n=e.count(t)-1;return e.rank(t).map((t=>t/n))}function Pr(t){return{map(e,n,r){const i=t(Lt(n,e));if(i.length!==e.length)throw new Error("mismatched length");for(let t=0,n=e.length;t<n;++t)r[e[t]]=i[t]}}}const _r={map(t,e,n){let r=0;for(const i of t)n[i]=r+=e[i]}};function jr(t){if(void 0===t)return Dr;if("function"==typeof t)return Gr(((e,n)=>t(Lt(n,e))));switch(`${t}`.toLowerCase()){case"deviation":return qr;case"first":return Dr;case"last":return Ir;case"max":return Xr;case"mean":return Wr;case"median":return Ur;case"min":return Vr;case"sum":return Hr;case"extent":return Fr}throw new Error("invalid basis")}function Gr(t){return{map(e,n,r){const i=+t(e,n);for(const t of e)r[t]=null===n[t]?NaN:n[t]/i}}}const Fr={map(t,n,r){const[i,o]=e.extent(t,(t=>n[t])),a=o-i;for(const e of t)r[e]=null===n[e]?NaN:(n[e]-i)/a}},Dr=Gr(((t,e)=>{for(let n=0;n<t.length;++n){const r=e[t[n]];if(a(r))return r}})),Ir=Gr(((t,e)=>{for(let n=t.length-1;n>=0;--n){const r=e[t[n]];if(a(r))return r}})),qr={map(t,n,r){const i=e.mean(t,(t=>n[t])),o=e.deviation(t,(t=>n[t]));for(const e of t)r[e]=null===n[e]?NaN:o?(n[e]-i)/o:0}},Xr=Gr(((t,n)=>e.max(t,(t=>n[t])))),Wr=Gr(((t,n)=>e.mean(t,(t=>n[t])))),Ur=Gr(((t,n)=>e.median(t,(t=>n[t])))),Vr=Gr(((t,n)=>e.min(t,(t=>n[t])))),Hr=Gr(((t,n)=>e.sum(t,(t=>n[t]))));function Zr(t={}){"number"==typeof t&&(t={k:t});let{k:n,reduce:r,shift:i,anchor:o=Qr(i)}=t;if(!((n=Math.floor(n))>0))throw new Error("invalid k");return function(t="mean"){if("string"==typeof t)switch(t.toLowerCase()){case"deviation":return Jr(e.deviation);case"max":return Jr(e.max);case"mean":return ti;case"median":return Jr(e.median);case"min":return Jr(e.min);case"mode":return Jr(e.mode);case"sum":return Kr;case"variance":return Jr(e.variance);case"difference":return ei;case"ratio":return ni}if("function"!=typeof t)throw new Error("invalid reduce");return Jr(t)}(r)(n,function(t="middle",e){switch(`${t}`.toLowerCase()){case"middle":return e-1>>1;case"start":return 0;case"end":return e-1}throw new Error("invalid anchor")}(o,n))}function Qr(t){if(void 0!==t){switch(console.warn("shift is deprecated; please use anchor instead"),`${t}`.toLowerCase()){case"centered":return"middle";case"leading":return"start";case"trailing":return"end"}throw new Error("invalid shift")}}function Jr(t){return(e,n)=>({map(r,i,o){const a=Float64Array.from(r,(t=>null===i[t]?NaN:i[t]));let s=0;for(let t=0;t<e-1;++t)isNaN(a[t])&&++s;for(let i=0,l=r.length-e+1;i<l;++i)isNaN(a[i+e-1])&&++s,o[r[i+n]]=0===s?t(a.subarray(i,i+e)):NaN,isNaN(a[i])&&--s}})}function Kr(t,e){return{map(n,r,i){let o=0,a=0;for(let e=0;e<t-1;++e){const t=r[n[e]];null===t||isNaN(t)?++o:a+=+t}for(let s=0,l=n.length-t+1;s<l;++s){const l=r[n[s]],c=r[n[s+t-1]];null===c||isNaN(c)?++o:a+=+c,i[n[s+e]]=0===o?a:NaN,null===l||isNaN(l)?--o:a-=+l}}}}function ti(t,e){const n=Kr(t,e);return{map(r,i,o){n.map(r,i,o);for(let n=0,i=r.length-t+1;n<i;++n)o[r[n+e]]/=t}}}function ei(t,e){return{map(n,r,i){for(let o=0,a=n.length-t;o<a;++o){const a=r[n[o]],s=r[n[o+t-1]];i[n[o+e]]=null===a||null===s?NaN:s-a}}}}function ni(t,e){return{map(n,r,i){for(let o=0,a=n.length-t;o<a;++o){const a=r[n[o]],s=r[n[o+t-1]];i[n[o+e]]=null===a||null===s?NaN:s/a}}}}function*ri(t){yield t[0]}function*ii(t){yield t[t.length-1]}function*oi(t,n){yield e.least(t,(t=>n[t]))}function*ai(t,n){yield e.greatest(t,(t=>n[t]))}function si(t,n,r){const i=Rt(r);return P(r,((r,o)=>{const a=ot(r,i),s=ot(r,n),l=[];for(const n of o){const r=[];for(const i of a?e.group(n,(t=>a[t])).values():[n])for(const e of t(i,s))r.push(e);l.push(r)}return{data:r,facets:l}}))}t.Area=_n,t.BarX=Vn,t.BarY=Hn,t.Cell=Zn,t.Dot=Jn,t.Frame=tr,t.Image=nr,t.Line=ir,t.Link=ar,t.Mark=rt,t.Rect=cr,t.RuleX=fr,t.RuleY=dr,t.Text=pr,t.TickX=wr,t.TickY=br,t.area=function(t,e){return new _n(t,e)},t.areaX=function(t,{y:e=st,...n}={}){return new _n(t,vn(mn({...n,y1:e,y2:void 0})))},t.areaY=function(t,{x:e=st,...n}={}){return new _n(t,xn(pn({...n,x1:e,x2:void 0})))},t.barX=function(t,e){return new Vn(t,vn(qn(mn(e))))},t.barY=function(t,e){return new Hn(t,xn(Xn(pn(e))))},t.bin=function(t={fill:"count"},e={}){[t,e]=$r(t,e);const{x:n,y:r}=function(t){let{x:e,y:n}=t;return e=Mr(e,t),n=Mr(n,t),[e.value,n.value]=Mt(e.value,n.value),{x:e,y:n}}(e);return kr(n,r,null,null,t,jn(Gn(e)))},t.binX=function(t={y:"count"},e={}){[t,e]=$r(t,e);const{x:n,y:r}=e;return kr(Mr(n,e,lt),null,null,r,t,jn(e))},t.binY=function(t={x:"count"},e={}){[t,e]=$r(t,e);const{x:n,y:r}=e;return kr(null,Mr(r,e,lt),n,null,t,Gn(e))},t.cell=function(t,{x:e,y:n,...r}={}){return[e,n]=Mt(e,n),new Zn(t,{...r,x:e,y:n})},t.cellX=function(t,{x:e=st,fill:n,stroke:r,...i}={}){return void 0===n&&void 0===gt(r)[0]&&(n=lt),new Zn(t,{...i,x:e,fill:n,stroke:r})},t.cellY=function(t,{y:e=st,fill:n,stroke:r,...i}={}){return void 0===n&&void 0===gt(r)[0]&&(n=lt),new Zn(t,{...i,y:e,fill:n,stroke:r})},t.dot=function(t,{x:e,y:n,...r}={}){return[e,n]=Mt(e,n),new Jn(t,{...r,x:e,y:n})},t.dotX=function(t,{x:e=lt,...n}={}){return new Jn(t,{...n,x:e})},t.dotY=function(t,{y:e=lt,...n}={}){return new Jn(t,{...n,y:e})},t.filter=function(t,e){return P(e,z(t))},t.formatIsoDate=o,t.formatMonth=function(t="en-US",e="short"){const n=new Intl.DateTimeFormat(t,{timeZone:"UTC",month:e});return t=>{if(null!=t&&!isNaN(t=new Date(Date.UTC(2e3,+t))))return n.format(t)}},t.formatWeekday=function(t="en-US",e="short"){const n=new Intl.DateTimeFormat(t,{timeZone:"UTC",weekday:e});return t=>{if(null!=t&&!isNaN(t=new Date(Date.UTC(2001,0,+t))))return n.format(t)}},t.frame=function(t){return new tr(t)},t.group=function(t={fill:"count"},e={}){let{x:n,y:r}=e;if([n,r]=Mt(n,r),null==n)throw new Error("missing channel: x");if(null==r)throw new Error("missing channel: y");return _(n,r,t,e)},t.groupX=function(t={y:"count"},e={}){const{x:n=lt}=e;if(null==n)throw new Error("missing channel: x");return _(n,null,t,e)},t.groupY=function(t={x:"count"},e={}){const{y:n=lt}=e;if(null==n)throw new Error("missing channel: y");return _(null,n,t,e)},t.groupZ=function(t,e){return _(null,null,t,e)},t.image=function(t,{x:e,y:n,...r}={}){return[e,n]=Mt(e,n),new nr(t,{...r,x:e,y:n})},t.legend=function(t={}){for(const[e,n]of ln){const r=t[e];if(bt(r))return n(Ce(e,r),cn(r,t))}throw new Error("unknown legend type")},t.line=function(t,{x:e,y:n,...r}={}){return[e,n]=Mt(e,n),new ir(t,{...r,x:e,y:n})},t.lineX=function(t,{x:e=lt,y:n=st,...r}={}){return new ir(t,{...r,x:e,y:n})},t.lineY=function(t,{x:e=st,y:n=lt,...r}={}){return new ir(t,{...r,x:e,y:n})},t.link=function(t,{x:e,x1:n,x2:r,y:i,y1:o,y2:a,...s}={}){return[n,r]=sr(e,n,r),[o,a]=sr(i,o,a),new ar(t,{...s,x1:n,x2:r,y1:o,y2:a})},t.map=Nr,t.mapX=zr,t.mapY=Er,t.marks=function(...t){return t.plot=rt.prototype.plot,t},t.normalize=jr,t.normalizeX=function(t,e){return 1===arguments.length&&({basis:t,...e}=t),zr(jr(t),e)},t.normalizeY=function(t,e){return 1===arguments.length&&({basis:t,...e}=t),Er(jr(t),e)},t.plot=un,t.rect=function(t,e){return new cr(t,qn(Xn(e)))},t.rectX=function(t,e){return new cr(t,vn(Xn(mn(e))))},t.rectY=function(t,e){return new cr(t,xn(qn(pn(e))))},t.reverse=function(t){return P(t,E)},t.ruleX=function(t,e){let{x:n=lt,y:r,y1:i,y2:o,...a}=Xn(e);return[i,o]=hr(r,i,o),new fr(t,{...a,x:n,y1:i,y2:o})},t.ruleY=function(t,e){let{y:n=lt,x:r,x1:i,x2:o,...a}=qn(e);return[i,o]=hr(r,i,o),new dr(t,{...a,y:n,x1:i,x2:o})},t.selectFirst=function(t){return si(ri,void 0,t)},t.selectLast=function(t){return si(ii,void 0,t)},t.selectMaxX=function(t={}){const e=t.x;if(null==e)throw new Error("missing channel: x");return si(ai,e,t)},t.selectMaxY=function(t={}){const e=t.y;if(null==e)throw new Error("missing channel: y");return si(ai,e,t)},t.selectMinX=function(t={}){const e=t.x;if(null==e)throw new Error("missing channel: x");return si(oi,e,t)},t.selectMinY=function(t={}){const e=t.y;if(null==e)throw new Error("missing channel: y");return si(oi,e,t)},t.shuffle=function({seed:t,...n}={}){return P(n,Y(null==t?Math.random:e.randomLcg(t)))},t.sort=function(t,e){return P(e,N(t))},t.stackX=gn,t.stackX1=function(t={},e={}){1===arguments.length&&([t,e]=bn(t));const{y1:n,y:r=n,x:i}=e,[o,a,s]=kn(r,i,"x",t,e);return{...o,y1:n,y:a,x:s}},t.stackX2=function(t={},e={}){1===arguments.length&&([t,e]=bn(t));const{y1:n,y:r=n,x:i}=e,[o,a,,s]=kn(r,i,"x",t,e);return{...o,y1:n,y:a,x:s}},t.stackY=yn,t.stackY1=function(t={},e={}){1===arguments.length&&([t,e]=bn(t));const{x1:n,x:r=n,y:i}=e,[o,a,s]=kn(r,i,"y",t,e);return{...o,x1:n,x:a,y:s}},t.stackY2=function(t={},e={}){1===arguments.length&&([t,e]=bn(t));const{x1:n,x:r=n,y:i}=e,[o,a,,s]=kn(r,i,"y",t,e);return{...o,x1:n,x:a,y:s}},t.text=function(t,{x:e,y:n,...r}={}){return[e,n]=Mt(e,n),new pr(t,{...r,x:e,y:n})},t.textX=function(t,{x:e=lt,...n}={}){return new pr(t,{...n,x:e})},t.textY=function(t,{y:e=lt,...n}={}){return new pr(t,{...n,y:e})},t.tickX=function(t,{x:e=lt,...n}={}){return new wr(t,{...n,x:e})},t.tickY=function(t,{y:e=lt,...n}={}){return new br(t,{...n,y:e})},t.valueof=ot,t.version="0.3.2",t.window=Zr,t.windowX=function(t={},e){return 1===arguments.length&&(e=t),zr(Zr(t),e)},t.windowY=function(t={},e){return 1===arguments.length&&(e=t),Er(Zr(t),e)},Object.defineProperty(t,"__esModule",{value:!0})}));
